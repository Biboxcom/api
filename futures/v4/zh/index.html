
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Bibox API文档(v4)</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sa, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-4f67ce97.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-628c1a7f.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-e033bdd3.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;,&quot;python&quot;,&quot;csharp&quot;]">
    <a href="#" id="nav-button">
      <span>
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <header>
      <div class="flex_box">
        <img src="images/logo-5720d610.png" class="logo" id="bibox-logo" alt="" />
        <div class="nav_box">
          <span id="spot_select" class="nav-select">
            <span id="btn_spot-select">
              现货
            </span>

            <span class="nav-select-drop">
              <a href="/api/spot/v4/zh/" class="nav-select-item" id="btn_spot_v4">现货v4</a>
              <a href="/api/spot/v3/zh/" class="nav-select-item" id="btn_spot">现货v3</a>
            </span>
          </span>
          <span class="nav-select">
            <span id="btn_contract-select">
              U本位永续合约
            </span>

            <span class="nav-select-drop big">
              <a href="/api/futures/v4/zh/" class="nav-select-item" id="btn_contract_v4">U本位永续合约 v4</a>
              <a href="/api/futures/v3/zh/" class="nav-select-item" id="btn_contract_v3">U本位永续合约 v3</a>
            </span>
          </span>
          <span class="nav_cell nav_tab">
            <a href="/api/futures-coin/v3/zh/" id="btn_contract_coin">币本位永续合约</a>
          </span>
        </div>
      </div>
      <a href="/api/spot/v3/en/" class="lang" id="lang_box">English</a>
    </header>
    <div class="toc-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="csharp">csharp</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#b122f813d5" class="toc-h1 toc-link" data-title="基本信息">基本信息</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#u-api" class="toc-h2 toc-link" data-title="U本位合约 API">U本位合约 API</a>
                  </li>
                  <li>
                    <a href="#a4d31b2542" class="toc-h2 toc-link" data-title="流量限制">流量限制</a>
                  </li>
                  <li>
                    <a href="#authentication" class="toc-h2 toc-link" data-title="Authentication">Authentication</a>
                  </li>
                  <li>
                    <a href="#api-key" class="toc-h2 toc-link" data-title="Api Key权限">Api Key权限</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#market-data-endpoints" class="toc-h1 toc-link" data-title="Market Data Endpoints">Market Data Endpoints</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-timestamp" class="toc-h2 toc-link" data-title="Get Timestamp">Get Timestamp</a>
                  </li>
                  <li>
                    <a href="#get-listed-pairs" class="toc-h2 toc-link" data-title="Get Listed Pairs">Get Listed Pairs</a>
                  </li>
                  <li>
                    <a href="#get-order-book" class="toc-h2 toc-link" data-title="Get Order Book">Get Order Book</a>
                  </li>
                  <li>
                    <a href="#get-candles" class="toc-h2 toc-link" data-title="Get Candles">Get Candles</a>
                  </li>
                  <li>
                    <a href="#get-tagprices" class="toc-h2 toc-link" data-title="Get TagPrices">Get TagPrices</a>
                  </li>
                  <li>
                    <a href="#get-indices" class="toc-h2 toc-link" data-title="Get Indices">Get Indices</a>
                  </li>
                  <li>
                    <a href="#get-trades" class="toc-h2 toc-link" data-title="Get Trades">Get Trades</a>
                  </li>
                  <li>
                    <a href="#get-tickers" class="toc-h2 toc-link" data-title="Get Tickers">Get Tickers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#market-data-streams" class="toc-h1 toc-link" data-title="Market Data Streams">Market Data Streams</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#request-methods" class="toc-h2 toc-link" data-title="Request Methods">Request Methods</a>
                  </li>
                  <li>
                    <a href="#subscribe-order-book" class="toc-h2 toc-link" data-title="Subscribe Order Book">Subscribe Order Book</a>
                  </li>
                  <li>
                    <a href="#subscribe-trades" class="toc-h2 toc-link" data-title="Subscribe Trades">Subscribe Trades</a>
                  </li>
                  <li>
                    <a href="#subscribe-candles" class="toc-h2 toc-link" data-title="Subscribe Candles">Subscribe Candles</a>
                  </li>
                  <li>
                    <a href="#subscribe-tickers" class="toc-h2 toc-link" data-title="Subscribe Tickers">Subscribe Tickers</a>
                  </li>
                  <li>
                    <a href="#subscribe-indices" class="toc-h2 toc-link" data-title="Subscribe Indices">Subscribe Indices</a>
                  </li>
                  <li>
                    <a href="#subscribe-tag-prices" class="toc-h2 toc-link" data-title="Subscribe Tag Prices">Subscribe Tag Prices</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user-data-endpoints" class="toc-h1 toc-link" data-title="User Data Endpoints">User Data Endpoints</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-accounts" class="toc-h2 toc-link" data-title="Get Accounts">Get Accounts</a>
                  </li>
                  <li>
                    <a href="#get-an-account-39-s-ledger" class="toc-h2 toc-link" data-title="Get an account's ledger">Get an account's ledger</a>
                  </li>
                  <li>
                    <a href="#create-an-order" class="toc-h2 toc-link" data-title="Create an order">Create an order</a>
                  </li>
                  <li>
                    <a href="#get-an-order" class="toc-h2 toc-link" data-title="Get an order">Get an order</a>
                  </li>
                  <li>
                    <a href="#get-orders" class="toc-h2 toc-link" data-title="Get Orders">Get Orders</a>
                  </li>
                  <li>
                    <a href="#cancel-orders" class="toc-h2 toc-link" data-title="Cancel Orders">Cancel Orders</a>
                  </li>
                  <li>
                    <a href="#cancel-all-orders" class="toc-h2 toc-link" data-title="Cancel all Orders">Cancel all Orders</a>
                  </li>
                  <li>
                    <a href="#get-fills" class="toc-h2 toc-link" data-title="Get fills">Get fills</a>
                  </li>
                  <li>
                    <a href="#create-an-plan-order" class="toc-h2 toc-link" data-title="Create an plan order">Create an plan order</a>
                  </li>
                  <li>
                    <a href="#edit-an-plan-order" class="toc-h2 toc-link" data-title="Edit an plan order">Edit an plan order</a>
                  </li>
                  <li>
                    <a href="#cancel-plan-orders" class="toc-h2 toc-link" data-title="Cancel Plan Orders">Cancel Plan Orders</a>
                  </li>
                  <li>
                    <a href="#cancel-all-plan-orders" class="toc-h2 toc-link" data-title="Cancel all Plan Orders">Cancel all Plan Orders</a>
                  </li>
                  <li>
                    <a href="#get-plan-orders" class="toc-h2 toc-link" data-title="Get Plan Orders">Get Plan Orders</a>
                  </li>
                  <li>
                    <a href="#get-positions" class="toc-h2 toc-link" data-title="Get Positions">Get Positions</a>
                  </li>
                  <li>
                    <a href="#change-position-mode" class="toc-h2 toc-link" data-title="Change Position Mode">Change Position Mode</a>
                  </li>
                  <li>
                    <a href="#change-position-margin" class="toc-h2 toc-link" data-title="Change Position Margin">Change Position Margin</a>
                  </li>
                  <li>
                    <a href="#clear-position-hold" class="toc-h2 toc-link" data-title="Clear Position Hold">Clear Position Hold</a>
                  </li>
                  <li>
                    <a href="#oppose-position" class="toc-h2 toc-link" data-title="Oppose Position">Oppose Position</a>
                  </li>
                  <li>
                    <a href="#get-position-logs" class="toc-h2 toc-link" data-title="Get Position Logs">Get Position Logs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user-data-streams" class="toc-h1 toc-link" data-title="User Data Streams">User Data Streams</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overview-2" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#account" class="toc-h2 toc-link" data-title="Account">Account</a>
                  </li>
                  <li>
                    <a href="#orders" class="toc-h2 toc-link" data-title="Orders">Orders</a>
                  </li>
                  <li>
                    <a href="#positions" class="toc-h2 toc-link" data-title="Positions">Positions</a>
                  </li>
                  <li>
                    <a href="#plan-orders" class="toc-h2 toc-link" data-title="Plan Orders">Plan Orders</a>
                  </li>
                  <li>
                    <a href="#fills" class="toc-h2 toc-link" data-title="Fills">Fills</a>
                  </li>
                  <li>
                    <a href="#ledgers" class="toc-h2 toc-link" data-title="Ledgers">Ledgers</a>
                  </li>
                  <li>
                    <a href="#deallogs" class="toc-h2 toc-link" data-title="DealLogs">DealLogs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#e08c1d4f9a" class="toc-h2 toc-link" data-title="错误码">错误码</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://www.bibox.com'>开始交易</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='b122f813d5'>基本信息</h1><h2 id='u-api'>U本位合约 API</h2>
<p><strong>使用 U本位合约 API开发应用程序，您可以准确地获取Bibox U本位合约市场的行情数据，快速进行自动化交易。U本位合约 API包含众多接口，按功能大致分为以下几组：</strong></p>

<ul>
<li>Market Data Endpoints 用于获取行情数据的REST接口</li>
<li>User Data Endpoints 用于获取用户私有数据的REST接口</li>
<li>Market Data Streams 用于获取行情数据的WebSocket接口</li>
<li>User Data Streams 用于获取用户私有数据的WebSocket接口</li>
</ul>

<p><strong>U本位合约 API使用如下Base URL：</strong></p>

<ul>
<li>Market Data Endpoints: https://api.bibox.com/api</li>
<li>User Data Endpoints: https://api.bibox.com/api</li>
<li>Market Data Stream: wss://market-wss.bibox360.com/cbu</li>
<li>User Data Stream: wss://user-wss.bibox360.com/cbu</li>
</ul>

<p><strong>备用api域名列表</strong></p>

<p><a href="https://api.bibox.tel/v1/public/queryApiDomain">https://api.bibox.tel/v1/public/queryApiDomain</a></p>

<p><strong>U本位合约 API的REST接口使用以下HTTP方法：</strong></p>

<ul>
<li>GET 用于获取行情或私有数据</li>
<li>POST 用于提交委托等操作</li>
<li>DELETE 用于撤销委托等操作</li>
</ul>

<p><strong>U本位合约 API的REST接口所需的参数应根据以下规则附加于请求中：</strong></p>

<ul>
<li>GET类型的接口参数应附加于Query String中</li>
<li>POST类型的接口参数应以JSON格式附加于Request Body中</li>
<li>DELETE类型的接口参数应以JSON格式附加于Request Body中</li>
</ul>

<p><strong>Response</strong></p>

<p>U本位合约 API的响应数据都以JSON格式返回，具体格式请参考各接口的描述。</p>

<p><strong>Error</strong></p>

<p>U本位合约 API的错误以如下JSON格式返回：</p>

<p>{<br/>
&nbsp;&nbsp;&quot;error&quot;: error code,<br/>
&nbsp;&nbsp;&quot;message&quot;: &quot;error message&quot;<br/>
}</p>

<p><em>其中，error表示错误的类型，message包含错误产生的原因或如何避免错误的提示。具体的错误类型请参考<a href="#errors">Error</a>章节的内容。</em></p>

<p><strong>Time or Timestamp</strong></p>

<p>U本位合约 API接口参数和响应数据中所涉及的时间值都是UNIX时间，单位为毫秒。</p>

<p><strong>分仓限制</strong></p>

<p>api不支持分仓。</p>

<hr>
<h2 id='a4d31b2542'>流量限制</h2>
<p><strong>Bibox对来自于同一IP的请求做以下访问限制:</strong></p>

<ol>
<li>Access Limits 访问频率限制</li>
<li>Usage Limits CPU用量限制</li>
</ol>

<ul>
<li>Access Limits访问频率限制

<ol>
<li>同一IP每10秒最多10000次请求，超出限制的请求会收到-2101错误。</li>
<li>用户可以根据需要在10秒内以任意频率发送最多10000次请求，可以大约每10ms发送一次，也可以在1秒内连续发送10000次，然后等待9秒。
<br/>
<br/></li>
</ol></li>
<li>Usage Limits用量限制

<ol>
<li>同一IP每10秒最多消耗10000点CPU 时间，超出限制的请求会收到-2102错误。</li>
<li>不同API消耗的CPU时间不同，这取决于API如何访问数据。</li>
<li>在本文中, 每个API接口访问数据的方式会以“缓存”, “数据库”的形式标明。访问缓存的API消耗的CPU时间较少，访问数据库的API消耗的CPU时间较多。根据用户发送的参数，API可能混合访问缓存和数据库，甚至多次访问数据库，这会增加API消耗的CPU时间。</li>
<li>每次API请求消耗的CPU时间会包含在响应头Bibox-Usage中，其格式为t1:t2:t3，其中，t1表示本次API请求消耗的CPU时间，t2表示最近10秒内当前IP消耗的CPU时间，t3表示最近10秒内当前IP剩余的可用CPU时间。</li>
</ol></li>
</ul>

<hr>
<h2 id='authentication'>Authentication</h2>
<blockquote>
<p>完整例子</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">asset=USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span> <span class="c1">// POST or DELETE  replace queryStr with bodyStr</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/accounts?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
          <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span> <span class="c1">// optional</span>
          <span class="p">},</span>
        <span class="p">},</span>

        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/accounts'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'asset=USDT'</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span> <span class="o">//</span> <span class="n">optional</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/accounts"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"asset=USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<p><strong>身份验证</strong></p>

<ul>
<li>私有接口用于访问账户、委托等私有信息，在请求时需要附加签名，以满足Bibox进行身份验证。本节将描述如何创建签名。</li>
</ul>

<p><strong>生成Api Key</strong></p>

<ul>
<li>要创建签名，首先需要生成Api Key和Secret Key组合。请牢记在此过程中生成的Secret Key，因为该值仅显示一次，如果忘记了Secret Key，请删除该Api Key，并生成新的Api Key和Secret Key组合。</li>
</ul>

<p><strong>HTTP 请求头</strong></p>

<p><strong>访问私有接口的请求都必需附加以下HTTP请求头：</strong></p>

<ul>
<li>Bibox-Api-Key 已生成的Api Key</li>
<li>Bibox-Api-Sign 签名</li>
</ul>

<p><strong>如果需要，也可以附加以下HTTP请求头：</strong></p>

<ul>
<li>Bibox-Expire-Time

<ol>
<li>接口过期时间。</li>
<li>该值是以毫秒为单位的Unix时间，服务器会忽略该时间之后收到的请求，这主要用于避免网络延迟带来的影响。</li>
<li>过期时间限制在未来60秒内。</li>
</ol></li>
</ul>

<p><strong>创建签名</strong></p>

<p>在发送请求前，首先确定用于签名的消息体。对于GET类型的请求，过期时间加上Query String是需要签名的消息体（expireTime:queryString），对于POST和DELETE类型的请求，过期时间加上Body String是需要签名的消息体（expireTime:bodyString）。签名的具体方法如下：</p>

<ul>
<li>第一步：以Secret Key作为Key对需要签名的消息体执行HmacSHA256算法</li>
<li>第二步：将以上结果转化为Hex String</li>
<li>第三步：将Hex String作为请求头Bibox-Api-Sign的值</li>
</ul>
<h2 id='api-key'>Api Key权限</h2>
<p><strong>私有接口需要特定的权限才能执行。可以为Api Key授予适当的权限。如果Api Key未被授予某个接口需要的权限，那么使用该Api Key提交的请求将被拒绝。</strong></p>

<p><strong>可以授予Api Key以下权限：</strong></p>

<ul>
<li>View权限允许Api Key获取私有数据。</li>
<li>Trade权限允许Api Key提交或撤销委托，并允许Api Key获取交易相关的数据。</li>
</ul>

<p><em>接口需要的权限将在每个接口的描述中给出。</em></p>

<hr>
<h1 id='market-data-endpoints'>Market Data Endpoints</h1><h2 id='get-timestamp'>Get Timestamp</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/timestamp</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/timestamp'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/timestamp"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="s2">"1653618929241"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>获取服务器时间</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/timestamp</li>
<li>Data source</li>
</ul>

<p>Cache</p>
<h2 id='get-listed-pairs'>Get Listed Pairs</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/pairs?symbol=4BTC_USDT</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/pairs?symbol=4BTC_USDT'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/pairs"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="s2">"4BTC_USDT"</span><span class="p">,</span><span class="w"> </span><span class="err">交易对名称</span><span class="w">
    </span><span class="nl">"base"</span><span class="p">:</span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quote"</span><span class="p">:</span><span class="s2">"USDT"</span><span class="p">,</span><span class="w"> </span><span class="err">计价币种</span><span class="w">
    </span><span class="nl">"price_scale"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">价格小数位</span><span class="w">
    </span><span class="nl">"quantity_min"</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span><span class="w"> </span><span class="err">最小下单量（币）</span><span class="w">
    </span><span class="nl">"quantity_max"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="err">最大下单量（币）</span><span class="w">
    </span><span class="nl">"quantity_increment"</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span><span class="err">下单增量（币）</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取币种列表</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/pairs</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等，<br/>可按如下形式指定多个交易对代码<br/>  /pairs?symbol=4BTC_USDT,4ETH_USDT<br/>  如果不指定 symbol 参数, 则返回全部交易对的信息</td>
</tr>
</tbody></table>

<ul>
<li>Data source</li>
</ul>

<p>Cache</p>
<h2 id='get-order-book'>Get Order Book</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/order_book?symbol=4BTC_USDT</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/order_book?symbol=4BTC_USDT'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/order_book"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"i"</span><span class="p">:</span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="nl">"t"</span><span class="p">:</span><span class="err">update</span><span class="w"> </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="nl">"b"</span><span class="p">:[</span><span class="w"> </span><span class="err">买盘</span><span class="w">
        </span><span class="p">[</span><span class="w">
            </span><span class="err">委托价格</span><span class="p">,</span><span class="w">
            </span><span class="err">委托量</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"a"</span><span class="p">:[</span><span class="w"> </span><span class="err">卖盘</span><span class="w">
        </span><span class="p">[</span><span class="w">
            </span><span class="err">委托价格</span><span class="p">,</span><span class="w">
            </span><span class="err">委托量</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>获取深度数据</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/order_book</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>level</td>
<td>int32</td>
<td>否</td>
<td>指定最多返回多少级深度<br/>有效值 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000<br/>默认值 100</td>
</tr>
<tr>
<td>price_scale</td>
<td>integer</td>
<td>否</td>
<td>指定按价格合并深度，如指定交易对的价格最多含4位小数<br/>price_scale=0 时返回的价格最多含4位小数,<br/>price_scale=1 时返回的价格最多含3位小数, 委托量是价格区间0.0010中全部委托量的和<br/>price_scale=2 时返回的价格最多含2位小数, 委托量是价格区间0.0100中全部委托量的和<br/>price_scale=3 时返回的价格最多含1位小数, 委托量是价格区间0.1000中全部委托量的和<br/>price_scale=4 时返回的价格最多含0位小数, 委托量是价格区间1.0000中全部委托量的和<br/>有效值 0, 1, 2, 3, 4, 5<br/>默认值 0</td>
</tr>
</tbody></table>

<blockquote>
<p>注意: 数据按价格最优排序, 即买侧深度按价格由大到小排序, 卖侧深度按价格由小到大排序</p>
</blockquote>

<ul>
<li>Data source</li>
</ul>

<p>Cache</p>
<h2 id='get-candles'>Get Candles</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/candles?symbol=4BTC_USDT&amp;time_frame=1m</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/candles?symbol=4BTC_USDT&amp;time_frame=1m'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/candles"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT&amp;time_frame=1m"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="err">open</span><span class="p">,</span><span class="w">
    </span><span class="err">high</span><span class="p">,</span><span class="w">
    </span><span class="err">low</span><span class="p">,</span><span class="w">
    </span><span class="err">close</span><span class="p">,</span><span class="w">
    </span><span class="err">volume</span><span class="p">,</span><span class="w">
    </span><span class="err">amount</span><span class="p">,</span><span class="w">
    </span><span class="err">first</span><span class="w"> </span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">trade</span><span class="w"> </span><span class="err">count</span><span class="p">,</span><span class="w">
  </span><span class="p">]</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取K线数据</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/candles</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>time_frame</td>
<td>string</td>
<td>是</td>
<td>K线数据的时间周期<br/>有效值 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 3d, 1W或1M</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最近时间</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最早时间</td>
</tr>
<tr>
<td>limit</td>
<td>integer</td>
<td>否</td>
<td>获取K线记录的最大数量<br/>默认值100，最大值1000</td>
</tr>
</tbody></table>

<ul>
<li>该接口支持的参数组合和数据源</li>
</ul>

<ol>
<li>symbol + time_frame  --&gt; cache</li>
<li>symbol + time_frame + limit  --&gt; cache</li>
<li>symbol + time_frame + before  --&gt; database</li>
<li>symbol + time_frame + before + limit  --&gt; database</li>
<li>symbol + time_frame + after  --&gt; database</li>
<li>symbol + time_frame + after + limit  --&gt; database</li>
</ol>

<blockquote>
<p>返回结果按时间由早及近排序</p>
</blockquote>
<h2 id='get-tagprices'>Get TagPrices</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/tagPrices?symbol=4BTC_USDT&amp;time_frame=1m</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/tagPrices?symbol=4BTC_USDT&amp;time_frame=1m'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/tagPrices"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT&amp;time_frame=1m"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="err">open</span><span class="p">,</span><span class="w">
    </span><span class="err">high</span><span class="p">,</span><span class="w">
    </span><span class="err">low</span><span class="p">,</span><span class="w">
    </span><span class="err">close</span><span class="p">,</span><span class="w">
    </span><span class="err">volume</span><span class="p">,</span><span class="w">
    </span><span class="err">amount</span><span class="p">,</span><span class="w">
    </span><span class="err">first</span><span class="w"> </span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">trade</span><span class="w"> </span><span class="err">count</span><span class="p">,</span><span class="w">
  </span><span class="p">]</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取标记价格数据</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/tagPrices</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>time_frame</td>
<td>string</td>
<td>是</td>
<td>K线数据的时间周期<br/>有效值 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 3d, 1W或1M</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最近时间</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最早时间</td>
</tr>
<tr>
<td>limit</td>
<td>integer</td>
<td>否</td>
<td>获取K线记录的最大数量<br/>默认值100，最大值1000</td>
</tr>
</tbody></table>

<ul>
<li>该接口支持的参数组合和数据源</li>
</ul>

<ol>
<li>symbol + time_frame  --&gt; cache</li>
<li>symbol + time_frame + limit  --&gt; cache</li>
<li>symbol + time_frame + before  --&gt; database</li>
<li>symbol + time_frame + before + limit  --&gt; database</li>
<li>symbol + time_frame + after  --&gt; database</li>
<li>symbol + time_frame + after + limit  --&gt; database</li>
</ol>

<blockquote>
<p>返回结果按时间由早及近排序</p>
</blockquote>
<h2 id='get-indices'>Get Indices</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/indices?symbol=4BTC_USDT&amp;time_frame=1m</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/indices?symbol=4BTC_USDT&amp;time_frame=1m'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/indices"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT&amp;time_frame=1m"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="err">open</span><span class="p">,</span><span class="w">
    </span><span class="err">high</span><span class="p">,</span><span class="w">
    </span><span class="err">low</span><span class="p">,</span><span class="w">
    </span><span class="err">close</span><span class="p">,</span><span class="w">
    </span><span class="err">volume</span><span class="p">,</span><span class="w">
    </span><span class="err">amount</span><span class="p">,</span><span class="w">
    </span><span class="err">first</span><span class="w"> </span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">trade</span><span class="w"> </span><span class="err">count</span><span class="p">,</span><span class="w">
  </span><span class="p">]</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取指数价格数据</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/indices</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>time_frame</td>
<td>string</td>
<td>是</td>
<td>K线数据的时间周期<br/>有效值 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 3d, 1W或1M</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最近时间</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>utc时间<br/>限定返回K线记录的最早时间</td>
</tr>
<tr>
<td>limit</td>
<td>integer</td>
<td>否</td>
<td>获取K线记录的最大数量<br/>默认值100，最大值1000</td>
</tr>
</tbody></table>

<ul>
<li>该接口支持的参数组合和数据源</li>
</ul>

<ol>
<li>symbol + time_frame  --&gt; cache</li>
<li>symbol + time_frame + limit  --&gt; cache</li>
<li>symbol + time_frame + before  --&gt; database</li>
<li>symbol + time_frame + before + limit  --&gt; database</li>
<li>symbol + time_frame + after  --&gt; database</li>
<li>symbol + time_frame + after + limit  --&gt; database</li>
</ol>

<blockquote>
<p>返回结果按时间由早及近排序</p>
</blockquote>
<h2 id='get-trades'>Get Trades</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/trades?symbol=4BTC_USDT</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/trades?symbol=4BTC_USDT'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/trades"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"i"</span><span class="p">:</span><span class="s2">"128851"</span><span class="p">,</span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="nl">"p"</span><span class="p">:</span><span class="s2">"30479.2"</span><span class="p">,</span><span class="err">成交价</span><span class="w">
    </span><span class="nl">"q"</span><span class="p">:</span><span class="s2">"0.04"</span><span class="p">,</span><span class="err">成交量</span><span class="w">
    </span><span class="nl">"s"</span><span class="p">:</span><span class="s2">"buy"</span><span class="p">,</span><span class="err">成交方向</span><span class="w">
    </span><span class="nl">"t"</span><span class="p">:</span><span class="s2">"1652434793000"</span><span class="p">,</span><span class="err">交易时间</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取交易记录</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/trades</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回交易记录的最早时间</td>
</tr>
<tr>
<td>end_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回交易记录的最近时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>交易记录 id<br/>限定返回交易记录的最大id</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>交易记录 id<br/>限定返回交易记录的最大id</td>
</tr>
<tr>
<td>limit</td>
<td>integer</td>
<td>否</td>
<td>获取记录的最大数量<br/>默认值100，最大值1000</td>
</tr>
</tbody></table>

<ul>
<li>该接口支持的参数组合和数据源</li>
</ul>

<ol>
<li>symbol  --&gt; cache</li>
<li>symbol + limit  --&gt; cache</li>
<li>symbol + start_time  --&gt; database</li>
<li>symbol + start_time + limit  --&gt; database</li>
<li>symbol + end_time  --&gt; database</li>
<li>symbol + end_time + limit  --&gt; database</li>
<li>symbol + start_time + end_time  --&gt; database</li>
<li>symbol + start_time + end_time + limit  --&gt; database</li>
<li>symbol + before  --&gt; database</li>
<li>symbol + before + limit  --&gt; database</li>
<li>symbol + after  --&gt; database</li>
<li>symbol + after + limit  --&gt; database</li>
</ol>

<p><em>数据源为cache的参数组合用于获取最近1000条交易记录</em></p>

<p><em>数据源为database的参数组合用于获取较早的交易记录</em></p>

<p><em>如果用数据源为database的参数组合获取最新交易记录，其结果要比cache数据源稍有延迟</em>
* Usage
  <strong>用法举例：获取三个月内某交易对的全部交易记录</strong></p>

<ol>
<li>首先使用symbol + limit 参数组合获取最新的交易记录</li>
<li>将取到的首条记录的trade id作为before参数的值，反复使用symbol + before + limit参数组合获取更多记录，直至获取三个月内的全部交易记录后停止</li>
</ol>

<blockquote>
<p>返回结果按交易记录id由小到大排序</p>
</blockquote>
<h2 id='get-tickers'>Get Tickers</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endPoint</span><span class="p">}</span><span class="err">/v4/cbu/marketdata/ticker?symbol=4BTC_USDT</span><span class="s2">`</span>
<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/marketdata/ticker?symbol=4BTC_USDT'</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/marketdata/ticker"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"s"</span><span class="p">:</span><span class="s2">"4BTC_USDT"</span><span class="p">,</span><span class="err">交易对名称</span><span class="w">
    </span><span class="nl">"o"</span><span class="p">:</span><span class="mf">31366.2</span><span class="p">,</span><span class="mi">24</span><span class="err">小时开盘价</span><span class="w">
    </span><span class="nl">"h"</span><span class="p">:</span><span class="mf">32117.7</span><span class="p">,</span><span class="mi">24</span><span class="err">小时最高价</span><span class="w">
    </span><span class="nl">"l"</span><span class="p">:</span><span class="mf">32117.7</span><span class="p">,</span><span class="mi">24</span><span class="err">小时最低价</span><span class="w">
    </span><span class="nl">"p"</span><span class="p">:</span><span class="mf">27650.5</span><span class="p">,</span><span class="err">最新价</span><span class="w">
    </span><span class="nl">"q"</span><span class="p">:</span><span class="mf">0.075</span><span class="p">,</span><span class="err">最后一单成交数量</span><span class="w">
    </span><span class="nl">"v"</span><span class="p">:</span><span class="mf">2239.385</span><span class="p">,</span><span class="err">成交量</span><span class="w">
    </span><span class="nl">"a"</span><span class="p">:</span><span class="mf">66224658.4286</span><span class="p">,</span><span class="err">成交价值</span><span class="w">
    </span><span class="nl">"c"</span><span class="p">:</span><span class="mf">-0.1184</span><span class="p">,</span><span class="err">涨跌幅</span><span class="w">
    </span><span class="nl">"t"</span><span class="p">:</span><span class="mi">57394</span><span class="p">,</span><span class="err">成交笔数</span><span class="w">
    </span><span class="nl">"f"</span><span class="p">:</span><span class="mi">63958</span><span class="p">,</span><span class="err">起始trade</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="nl">"bp"</span><span class="p">:</span><span class="mf">27643.4</span><span class="p">,</span><span class="err">买一价</span><span class="w">
    </span><span class="nl">"bq"</span><span class="p">:</span><span class="mf">0.089</span><span class="p">,</span><span class="err">买一数量</span><span class="w">
    </span><span class="nl">"ap"</span><span class="p">:</span><span class="mf">27645.5</span><span class="p">,</span><span class="err">卖一价</span><span class="w">
    </span><span class="nl">"aq"</span><span class="p">:</span><span class="mf">0.01</span><span class="err">，卖一数量</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取报价数据</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/marketdata/ticker</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等，<br/>可按如下形式指定多个交易对代码<br/>  /pairs?symbol=4BTC_USDT,4ETH_USDT</td>
</tr>
</tbody></table>

<ul>
<li>Data Source</li>
</ul>

<p>Cache</p>
<h1 id='market-data-streams'>Market Data Streams</h1><h2 id='overview'>Overview</h2>
<blockquote>
<p>例子</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">biboxws</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">wss://market-wss.bibox360.com/cbu</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">wsClass</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>

<span class="nx">wsClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_initWs</span> <span class="o">=</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">biboxws</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">biboxws</span><span class="p">);</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">ws</span> <span class="o">=</span> <span class="nx">ws</span><span class="p">;</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">open</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
            <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SUBSCRIBE</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">params</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="dl">"</span><span class="s2">4BTC_USDT.order_book.1</span><span class="dl">"</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">}));</span>
        <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">ws</span><span class="p">.</span><span class="nx">ping</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span>
        <span class="p">},</span><span class="mi">30000</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">close, </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ping </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">pong</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">pong </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">rece message</span><span class="dl">"</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wsClass</span><span class="p">();</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">_initWs</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">ws_url</span> <span class="o">=</span> <span class="s">'wss://market-wss.bibox360.com/cbu'</span>

<span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\'</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_sub_str</span><span class="p">():</span>
    <span class="n">subdata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"id"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
        <span class="s">"method"</span><span class="p">:</span> <span class="s">"SUBSCRIBE"</span><span class="p">,</span>
        <span class="s">"params"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"4BTC_USDT.order_book.1"</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">stringify</span><span class="p">(</span><span class="n">subdata</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"### closed ###"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_open</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">get_sub_str</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="c1"># websocket.enableTrace(True)
</span>    <span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="p">.</span><span class="n">WebSocketApp</span><span class="p">(</span><span class="n">ws_url</span><span class="p">,</span>
                                <span class="n">on_message</span><span class="o">=</span><span class="n">on_message</span><span class="p">,</span>
                                <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
                                <span class="n">on_close</span><span class="o">=</span><span class="n">on_close</span><span class="p">)</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">on_open</span> <span class="o">=</span> <span class="n">on_open</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">run_forever</span><span class="p">(</span><span class="n">ping_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ping_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">connect</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">WebSocketSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO.Compression</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Example</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span> <span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">wsuri</span> <span class="p">=</span> <span class="s">"wss://market-wss.bibox360.com/cbu"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">jarray</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JArray</span><span class="p">();</span>
            <span class="n">jarray</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"4BTC_USDT.order_book.1"</span><span class="p">);</span>
            <span class="n">JObject</span> <span class="n">val</span> <span class="p">=</span> <span class="k">new</span> <span class="n">JObject</span> <span class="p">{</span>
                <span class="p">{</span><span class="s">"id"</span><span class="p">,</span> <span class="m">123</span> <span class="p">},</span>
                <span class="p">{</span><span class="s">"method"</span><span class="p">,</span> <span class="s">"SUBSCRIBE"</span> <span class="p">},</span>
                <span class="p">{</span><span class="s">"params"</span><span class="p">,</span> <span class="n">jarray</span> <span class="p">}</span>
            <span class="p">};</span>
            <span class="kt">string</span> <span class="n">payload</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ws</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebSocket</span> <span class="p">(</span><span class="n">wsuri</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">ws</span><span class="p">.</span><span class="n">OnMessage</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span> <span class="p">(</span><span class="s">"recv: "</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>

            <span class="p">};</span>

            <span class="n">ws</span><span class="p">.</span><span class="nf">Connect</span> <span class="p">();</span>

            <span class="n">ws</span><span class="p">.</span><span class="nf">Send</span> <span class="p">(</span><span class="n">payload</span><span class="p">);</span>

            <span class="n">ConsoleKey</span> <span class="n">key</span><span class="p">;</span>
            <span class="k">do</span>
            <span class="p">{</span>
                  <span class="n">key</span><span class="p">=</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">().</span><span class="n">Key</span><span class="p">;</span>

            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">key</span> <span class="p">!=</span> <span class="n">ConsoleKey</span><span class="p">.</span><span class="n">Q</span><span class="p">);</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<p><strong>使用 Websocket 推送服务可以及时获取行情信息。</strong></p>

<ul>
<li>连接 Websocket 服务器
请使用以下 URL 连接 Websocket 服务器：
<br/>
wss://market-wss.bibox360.com/cbu</li>
</ul>

<blockquote>
<p>在连接后，客户端可以发送以下JSON格式的请求给服务器</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">由客户端给定的请求id</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求类型</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求参数列表</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>在收到请求后，服务器会发送以下JSON格式的响应给客户端</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求id</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求结果</span><span class="p">,</span><span class="w"> </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w"> </span><span class="err">也是代表订阅成功</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>如果发生错误，服务器会发送以下错误信息给客户端</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求id</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1000</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">错误代码</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">错误描述</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>同时，服务器还会发送以下JSON格式的数据流给客户端, 数据流包含市场行情的变化信息</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4BTC_USDT.trades"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">数据流名称</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">数据</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>请求：订阅数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"stream name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stream name"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>在连接后，请首先发送该请求给服务器，随后，服务器会在行情变化时发送相应的数据流给客户端。</p>

<p>&quot;data stream name&quot; 是数据流名称，数据流名称是以下格式的字符串。
symbol.data_type.param1.param2...</p>

<p>其中，symbol是交易对名称，如 4BTC_USDT、4ETH_USDT 等。
data_type是数据类型，目前仅支持以下数据类型
order_book: 深度
trades: 交易列表
candles: K线
ticker: 最新成交信息
indices: 指数价格K线
tagPrices: 标记价格K线</p>

<p>在data_type之后是参数列表，不同的数据类型有不同的参数列表，这些将在后续介绍</p>

<p>请求: 取消订阅数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNSUBSCRIBE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"data stream name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data stream name"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>如果请求被服务器正确处理，客户端会收到以下响应:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>如果请求出错，客户端会收到以下错误响应:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求id</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1000</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">错误代码</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">错误描述</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>需要定时主动发送ping到推服务器，避免长时间没有消息导致服务断开</p>
</blockquote>
<h2 id='request-methods'>Request Methods</h2>
<blockquote>
<p>请求类型及参数</p>

<p>客户端可以发送以下请求给服务器</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">由客户端给定的请求id</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求类型</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">请求参数列表</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>其中method字段的值是以下请求类型之一:</li>
</ul>

<table><thead>
<tr>
<th>可选值</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>SUBSCRIBE</td>
<td>1.订阅数据流<br/> 2.参数是数据流名称列表 <br/> 3.在成功订阅后，服务器会在行情发生变化时发送数据流给客户端</td>
</tr>
<tr>
<td>UNSUBSCRIBE</td>
<td>1.取消订阅数据流<br/> 2.参数是数据流名称列表 <br/> 3.在成功取消订阅后，客户端不会再收到相应的数据流</td>
</tr>
</tbody></table>
<h2 id='subscribe-order-book'>Subscribe Order Book</h2>
<p><strong>订阅深度信息</strong></p>

<blockquote>
<p>发送以下请求可订阅深度信息</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.order_book.1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.order_book.1"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>该请求的参数是深度流名称，格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.order_book.&lt;max depth&gt;

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
<li>&lt;max depth&gt; 是最大深度，有效值是1, 2, 5, 10, 20, 50, 100, 200, 500, 1000</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4APE_USDT.order_book.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"i"</span><span class="p">:</span><span class="s2">"13890055"</span><span class="p">,</span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="nl">"t"</span><span class="p">:</span><span class="s2">"1654826751000"</span><span class="p">,</span><span class="err">时间</span><span class="w">
        </span><span class="nl">"b"</span><span class="p">:[</span><span class="w"> </span><span class="err">买盘</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="err">价格</span><span class="p">,</span><span class="w">
                </span><span class="err">数量</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="s2">"5.645"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"103"</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"a"</span><span class="p">:[</span><span class="w"> </span><span class="err">卖盘</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="s2">"5.646"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"902"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="s2">"5.647"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"0"</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>在成功订阅后，客户端会首先收到一个完整深度的数据流，之后会收到增量变化数据流，请按以下方法合成完整的深度.
数量为0，代表该深度被删除.
价格相同，则数量直接替换.</p>
</blockquote>
<h2 id='subscribe-trades'>Subscribe Trades</h2>
<p><strong>订阅交易列表</strong></p>

<blockquote>
<p>发送以下请求可订阅交易列表</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.trades"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.trades"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>该请求的参数是交易流名称，格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.trades

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4BTC_USDT.trades"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"i"</span><span class="p">:</span><span class="s2">"128851"</span><span class="p">,</span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="w">
            </span><span class="nl">"p"</span><span class="p">:</span><span class="s2">"30479.2"</span><span class="p">,</span><span class="err">成交价</span><span class="w">
            </span><span class="nl">"q"</span><span class="p">:</span><span class="s2">"0.04"</span><span class="p">,</span><span class="err">成交量</span><span class="w">
            </span><span class="nl">"s"</span><span class="p">:</span><span class="s2">"buy"</span><span class="p">,</span><span class="err">成交方向</span><span class="w">
            </span><span class="nl">"t"</span><span class="p">:</span><span class="s2">"1652434793000"</span><span class="p">,</span><span class="err">交易时间</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='subscribe-candles'>Subscribe Candles</h2>
<p><strong>订阅K线</strong></p>

<blockquote>
<p>发送以下请求可订阅K线</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.candles.1m"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.candles.1h"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>K线流名称格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.candles.&lt;time_frame&gt;

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
<li>&lt;time_frame&gt; 是K线周期，有效值是1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 1w, 1M</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4BTC_USDT.candles.1m"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">数据类别</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"t"</span><span class="p">:</span><span class="mi">60000</span><span class="p">,</span><span class="w">
        </span><span class="nl">"e"</span><span class="p">:[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="err">time</span><span class="p">,</span><span class="w">
                </span><span class="err">open</span><span class="p">,</span><span class="w">
                </span><span class="err">high</span><span class="p">,</span><span class="w">
                </span><span class="err">low</span><span class="p">,</span><span class="w">
                </span><span class="err">close</span><span class="p">,</span><span class="w">
                </span><span class="err">volume</span><span class="p">,</span><span class="w">
                </span><span class="err">amount</span><span class="p">,</span><span class="w">
                </span><span class="err">first</span><span class="w"> </span><span class="err">trade</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
                </span><span class="err">trade</span><span class="w"> </span><span class="err">count</span><span class="p">,</span><span class="w">
            </span><span class="p">]</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='subscribe-tickers'>Subscribe Tickers</h2>
<p><strong>订阅K线</strong></p>

<blockquote>
<p>发送以下请求可订阅Ticker</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.ticker"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.ticker"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>Ticker流名称格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.ticker

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4BTC_USDT.ticker"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"s"</span><span class="p">:</span><span class="s2">"4BTC_USDT"</span><span class="p">,</span><span class="err">交易对名称</span><span class="w">
        </span><span class="nl">"o"</span><span class="p">:</span><span class="mf">31366.2</span><span class="p">,</span><span class="mi">24</span><span class="err">小时开盘价</span><span class="w">
        </span><span class="nl">"h"</span><span class="p">:</span><span class="mf">32117.7</span><span class="p">,</span><span class="mi">24</span><span class="err">小时最高价</span><span class="w">
        </span><span class="nl">"l"</span><span class="p">:</span><span class="mf">32117.7</span><span class="p">,</span><span class="mi">24</span><span class="err">小时最低价</span><span class="w">
        </span><span class="nl">"p"</span><span class="p">:</span><span class="mf">27650.5</span><span class="p">,</span><span class="err">最新价</span><span class="w">
        </span><span class="nl">"q"</span><span class="p">:</span><span class="mf">0.075</span><span class="p">,</span><span class="err">最后一单成交数量</span><span class="w">
        </span><span class="nl">"v"</span><span class="p">:</span><span class="mf">2239.385</span><span class="p">,</span><span class="err">成交量</span><span class="w">
        </span><span class="nl">"a"</span><span class="p">:</span><span class="mf">66224658.4286</span><span class="p">,</span><span class="err">成交价值</span><span class="w">
        </span><span class="nl">"c"</span><span class="p">:</span><span class="mf">-0.1184</span><span class="p">,</span><span class="err">涨跌幅</span><span class="w">
        </span><span class="nl">"t"</span><span class="p">:</span><span class="mi">57394</span><span class="p">,</span><span class="err">成交笔数</span><span class="w">
        </span><span class="nl">"f"</span><span class="p">:</span><span class="mi">63958</span><span class="p">,</span><span class="err">起始trade</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="nl">"bp"</span><span class="p">:</span><span class="mf">27643.4</span><span class="p">,</span><span class="err">买一价</span><span class="w">
        </span><span class="nl">"bq"</span><span class="p">:</span><span class="mf">0.089</span><span class="p">,</span><span class="err">买一数量</span><span class="w">
        </span><span class="nl">"ap"</span><span class="p">:</span><span class="mf">27645.5</span><span class="p">,</span><span class="err">卖一价</span><span class="w">
        </span><span class="nl">"aq"</span><span class="p">:</span><span class="mf">0.01</span><span class="err">，卖一数量</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='subscribe-indices'>Subscribe Indices</h2>
<p><strong>订阅指数K线</strong></p>

<blockquote>
<p>发送以下请求可订阅指数K线</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.indices.1m"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.indices.1h"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>指数K线流名称格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.indices.&lt;time_frame&gt;

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
<li>&lt;time_frame&gt; 是K线周期，有效值是1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 1w, 1M</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4BTC_USDT.indices.1m"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">数据类别</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"t"</span><span class="p">:</span><span class="mi">60000</span><span class="p">,</span><span class="w">
        </span><span class="nl">"e"</span><span class="p">:[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="err">time</span><span class="p">,</span><span class="w">
                </span><span class="err">open(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">high(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">low(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">close</span><span class="p">,</span><span class="w">
                </span><span class="err">volume(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">amount(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">firstTradeId(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">tradeCount(ignore)</span><span class="p">,</span><span class="w">
            </span><span class="p">]</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='subscribe-tag-prices'>Subscribe Tag Prices</h2>
<p><strong>订阅标记价格K线</strong></p>

<blockquote>
<p>发送以下请求可订阅标记价格K线</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUBSCRIBE"</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"4BTC_USDT.tagPrices.1m"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4ETH_USDT.tagPrices.1h"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>参数</li>
</ul>

<ol>
<li>标记价格K线流名称格式如下：</li>
</ol>

<ul>
<li>&lt;symbol&gt;.tagPrices.&lt;time_frame&gt;

<ol>
<li>&lt;symbol&gt; 是交易对名称，如4BTC_USDT，4ETH_USDT等</li>
<li>&lt;time_frame&gt; 是K线周期，有效值是1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 1w, 1M</li>
</ol></li>
</ul>

<blockquote>
<p>数据流</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">订阅成功会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"result"</span><span class="p">:</span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">之后会返回如下数据流</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"4BTC_USDT.tagPrices.1m"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">数据类别</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"t"</span><span class="p">:</span><span class="mi">60000</span><span class="p">,</span><span class="w">
        </span><span class="nl">"e"</span><span class="p">:[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="err">time</span><span class="p">,</span><span class="w">
                </span><span class="err">open(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">high(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">low(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">close</span><span class="p">,</span><span class="w">
                </span><span class="err">volume(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">amount(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">firstTradeId(ignore)</span><span class="p">,</span><span class="w">
                </span><span class="err">tradeCount(ignore)</span><span class="p">,</span><span class="w">
            </span><span class="p">]</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<hr>
<h1 id='user-data-endpoints'>User Data Endpoints</h1><h2 id='get-accounts'>Get Accounts</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">asset=USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/accounts?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
          <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span> <span class="c1">// optional</span>
          <span class="p">},</span>
        <span class="p">},</span>

        <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

        <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/accounts'</span>

    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'asset=USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/accounts"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"asset=USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">c:</span><span class="w"> </span><span class="err">'USDT'</span><span class="p">,</span><span class="w"> </span><span class="err">币种符号</span><span class="w">
    </span><span class="err">b:</span><span class="w"> </span><span class="err">'</span><span class="mf">8247.1187293513</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">账户可用余额</span><span class="w">
    </span><span class="err">ff:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">逐仓挂单冻结</span><span class="w">
    </span><span class="err">fc:</span><span class="w"> </span><span class="err">'</span><span class="mf">346.73844114</span><span class="err">'</span><span class="p">,</span><span class="err">全仓挂单冻结</span><span class="w">
    </span><span class="err">mf:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="err">逐仓保证金</span><span class="w">
    </span><span class="err">mc:</span><span class="w"> </span><span class="err">'</span><span class="mf">1396.55822362</span><span class="err">'</span><span class="p">,</span><span class="err">全仓保证金</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取 API Key 对应账户中各种资产的余额, 冻结等信息</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/accounts</li>
<li>权限: View, Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>asset</td>
<td>string</td>
<td>否</td>
<td>资产代码，如 USDT 等<br/>可按以下形式指定多个资产代码<br/> /v4/cbu/userdata/accounts?asset=BTC,ETH<br/>  如果不指定 asset 参数, 则返回全部资产的信息</td>
</tr>
</tbody></table>

<ul>
<li>Data Source</li>
</ul>

<p>Cache</p>
<h2 id='get-an-account-39-s-ledger'>Get an account&#39;s ledger</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">asset=USDT&amp;end_time=1651895799668&amp;limit=10</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/ledger?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/ledger'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'asset=USDT&amp;end_time=1651895799668&amp;limit=10'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/ledger"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"asset=USDT&amp;end_time=1651895799668&amp;limit=10"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">i:</span><span class="w"> </span><span class="err">ledger</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">s:</span><span class="w"> </span><span class="err">币种符号</span><span class="w">
    </span><span class="err">p:</span><span class="w"> </span><span class="err">交易对</span><span class="w">
    </span><span class="err">T:</span><span class="w"> </span><span class="err">账单类型</span><span class="w"> </span><span class="mi">1</span><span class="err">划转</span><span class="p">,</span><span class="mi">2</span><span class="err">交易</span><span class="p">,</span><span class="mi">3</span><span class="err">交易手续费</span><span class="p">,</span><span class="mi">4</span><span class="err">资金费用</span><span class="p">,</span><span class="mi">5</span><span class="err">资金费用调整</span><span class="p">,</span><span class="mi">6</span><span class="err">降低风险等级减仓</span><span class="p">,</span><span class="mi">7</span><span class="err">强平</span><span class="p">,</span><span class="mi">8</span><span class="err">ADL系统减仓</span><span class="w">
    </span><span class="err">a:</span><span class="w"> </span><span class="err">改变量</span><span class="w">
    </span><span class="err">b:</span><span class="w"> </span><span class="err">余额</span><span class="w">
    </span><span class="err">t:</span><span class="w"> </span><span class="err">时间</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取 API Key 对应账户的账单，包含一切改变账户余额的记录，如资金划转、交易、手续费收取等</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/ledger</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>asset</td>
<td>string</td>
<td>否</td>
<td>资产代码，如 USDT 等<br/>可按以下形式指定多个资产代码<br/> /v4/cbu/userdata/ledger?asset=BTC,ETH <br/> 如果不指定 asset 参数, 则返回全部资产的账单记录</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回账单记录的最早时间</td>
</tr>
<tr>
<td>end_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回账单记录的最近时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>账单记录id<br/>限定返回账单记录的最大id值</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>账单记录id<br/>限定返回账单记录的最小id值</td>
</tr>
<tr>
<td>limit</td>
<td>int32</td>
<td>否</td>
<td>限定返回账单记录的最大条数<br/>默认值 100</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回账单记录的最早时间</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回账单记录的最早时间</td>
</tr>
</tbody></table>

<ul>
<li>Data Source</li>
</ul>

<p>DB</p>
<h2 id='create-an-order'>Create an order</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">order_side</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">order_type</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">amount</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0.001</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">price</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">20000</span><span class="dl">'</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/order</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'order_side'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">'order_type'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">'amount'</span><span class="p">:</span> <span class="s">'0.001'</span><span class="p">,</span>
        <span class="s">'price'</span><span class="p">:</span> <span class="s">'20000'</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/order'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/order"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">order_side</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
                 <span class="n">order_type</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
                 <span class="n">price</span> <span class="p">=</span> <span class="s">"20000"</span><span class="p">,</span>
                 <span class="n">amount</span> <span class="p">=</span> <span class="s">"0.001"</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">i:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">I:</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
  </span><span class="err">T:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">type。</span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="w">
  </span><span class="err">s:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">side。</span><span class="mi">1</span><span class="err">开多，</span><span class="mi">2</span><span class="err">开空，</span><span class="mi">3</span><span class="err">平多，</span><span class="mi">4</span><span class="err">平空</span><span class="w">
  </span><span class="err">Q:</span><span class="w"> </span><span class="err">下单数量</span><span class="w">
  </span><span class="err">P:</span><span class="w"> </span><span class="err">下单价格</span><span class="w">
  </span><span class="err">S:</span><span class="w"> </span><span class="err">订单状态。</span><span class="mi">1</span><span class="err">未成交，</span><span class="mi">2</span><span class="err">部分成交，</span><span class="mi">3</span><span class="err">完全成交，</span><span class="mi">4</span><span class="err">部分撤销，</span><span class="mi">5</span><span class="err">全部撤销，</span><span class="mi">100</span><span class="err">下单失败</span><span class="w">
  </span><span class="err">r:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
  </span><span class="err">M:</span><span class="w"> </span><span class="err">失败描述</span><span class="w">
  </span><span class="err">E:</span><span class="w"> </span><span class="err">已成交数量</span><span class="w">
  </span><span class="err">e:</span><span class="w"> </span><span class="err">成交均价</span><span class="w">
  </span><span class="err">C:</span><span class="w"> </span><span class="err">订单创建时间</span><span class="w">
  </span><span class="err">U:</span><span class="w"> </span><span class="err">订单更新时间</span><span class="w">
  </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">z:</span><span class="w"> </span><span class="err">订单冻结资产</span><span class="w">
  </span><span class="err">rm:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
  </span><span class="err">rt:</span><span class="w"> </span><span class="err">taker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
  </span><span class="err">of:</span><span class="w"> </span><span class="err">订单来源</span><span class="w">
  </span><span class="err">pid:</span><span class="w"> </span><span class="err">对应仓位id</span><span class="w">
  </span><span class="err">ot:</span><span class="w"> </span><span class="err">包含止盈止损委托的下单类型</span><span class="w">
  </span><span class="err">f:</span><span class="w"> </span><span class="err">手续费</span><span class="w">
  </span><span class="err">fb:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="w">
  </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">抵扣手续费</span><span class="w">
  </span><span class="err">n:</span><span class="w"> </span><span class="err">成交笔数</span><span class="w">
  </span><span class="err">F:</span><span class="w"> </span><span class="p">[</span><span class="err">//</span><span class="w"> </span><span class="err">成交明细，只展示最近</span><span class="mi">20</span><span class="err">条</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">i:</span><span class="w"> </span><span class="err">fill</span><span class="w"> </span><span class="err">id</span><span class="w">
      </span><span class="err">t:</span><span class="w"> </span><span class="err">time</span><span class="w">
      </span><span class="err">p:</span><span class="w"> </span><span class="err">price</span><span class="w">
      </span><span class="err">q:</span><span class="w"> </span><span class="err">quantity</span><span class="w">
      </span><span class="err">l:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">taker</span><span class="w">
      </span><span class="err">f:</span><span class="w"> </span><span class="err">fee</span><span class="w">
      </span><span class="err">fb:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">discount</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>提交委托</strong></p>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/order</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>order_side</td>
<td>string</td>
<td>是</td>
<td>委托方向，有效值 1 开多，2 开空， 3 平多， 4 平空</td>
</tr>
<tr>
<td>order_type</td>
<td>string</td>
<td>是</td>
<td>委托类型，有效值 1 市价单， 2 限价单</td>
</tr>
<tr>
<td>client_oid</td>
<td>string</td>
<td>否</td>
<td>委托id，有效值为int64整数的字符串，建议使用提交委托时的Unix时间戳</td>
</tr>
<tr>
<td>amount</td>
<td>decimal</td>
<td>否</td>
<td>委托量</td>
</tr>
<tr>
<td>price</td>
<td>decimal</td>
<td>否</td>
<td>委托限价</td>
</tr>
</tbody></table>

<blockquote>
<p>委托对象
最多包含该委托的20笔成交
如果委托有多于20笔成交，那么该对象仅包含最后20笔，其他成交请通过 fills 接口获取</p>
</blockquote>
<h2 id='get-an-order'>Get an order</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">order_id=1118621391231</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/order?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/order'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'order_id=14118828812271651'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/order"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"order_id=14118828812271651"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">i:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">I:</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
  </span><span class="err">T:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">type。</span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="w">
  </span><span class="err">s:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">side。</span><span class="mi">1</span><span class="err">开多，</span><span class="mi">2</span><span class="err">开空，</span><span class="mi">3</span><span class="err">平多，</span><span class="mi">4</span><span class="err">平空</span><span class="w">
  </span><span class="err">Q:</span><span class="w"> </span><span class="err">下单数量</span><span class="w">
  </span><span class="err">P:</span><span class="w"> </span><span class="err">下单价格</span><span class="w">
  </span><span class="err">S:</span><span class="w"> </span><span class="err">订单状态。</span><span class="mi">1</span><span class="err">未成交，</span><span class="mi">2</span><span class="err">部分成交，</span><span class="mi">3</span><span class="err">完全成交，</span><span class="mi">4</span><span class="err">部分撤销，</span><span class="mi">5</span><span class="err">全部撤销，</span><span class="mi">100</span><span class="err">下单失败</span><span class="w">
  </span><span class="err">r:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
  </span><span class="err">M:</span><span class="w"> </span><span class="err">失败描述</span><span class="w">
  </span><span class="err">E:</span><span class="w"> </span><span class="err">已成交数量</span><span class="w">
  </span><span class="err">e:</span><span class="w"> </span><span class="err">成交均价</span><span class="w">
  </span><span class="err">C:</span><span class="w"> </span><span class="err">订单创建时间</span><span class="w">
  </span><span class="err">U:</span><span class="w"> </span><span class="err">订单更新时间</span><span class="w">
  </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="err">z:</span><span class="w"> </span><span class="err">订单冻结资产</span><span class="w">
  </span><span class="err">rm:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
  </span><span class="err">rt:</span><span class="w"> </span><span class="err">taker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
  </span><span class="err">of:</span><span class="w"> </span><span class="err">订单来源</span><span class="w">
  </span><span class="err">pid:</span><span class="w"> </span><span class="err">对应仓位id</span><span class="w">
  </span><span class="err">ot:</span><span class="w"> </span><span class="err">包含止盈止损委托的下单类型</span><span class="w">
  </span><span class="err">f:</span><span class="w"> </span><span class="err">手续费</span><span class="w">
  </span><span class="err">fb:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="w">
  </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">抵扣手续费</span><span class="w">
  </span><span class="err">n:</span><span class="w"> </span><span class="err">成交笔数</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>获取指定 id 的委托</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/order</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>order_id</td>
<td>string</td>
<td>是</td>
<td>委托id<br/>委托id可以是交易所分配的, <br/>也可以是用户自定义的 (在提交委托时使用client_order_id参数).<br/>当使用自定义id时, 需要在id前添加 “c-” 前缀.<br/>例如: 提交委托时使用了自定义id “123”, 在获取委托时, 需使用 “c-123”.</td>
</tr>
</tbody></table>
<h2 id='get-orders'>Get Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">limit=2&amp;status=settled&amp;symbol=4BTC_USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/orders?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/orders'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'limit=2&amp;status=settled&amp;symbol=4BTC_USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/orders"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"limit=2&amp;status=settled&amp;symbol=4BTC_USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">[</span>
  <span class="p">{</span>
      <span class="na">i</span><span class="p">:</span> <span class="nx">order</span> <span class="nx">id</span>
      <span class="na">I</span><span class="p">:</span> <span class="nx">client</span> <span class="nx">order</span> <span class="nx">id</span>
      <span class="na">m</span><span class="p">:</span> <span class="nx">pair</span>
      <span class="na">T</span><span class="p">:</span> <span class="nx">order</span> <span class="nx">type</span><span class="err">。</span><span class="mi">1</span><span class="nx">市价</span><span class="err">，</span><span class="mi">2</span><span class="nx">限价</span>
      <span class="na">s</span><span class="p">:</span> <span class="nx">order</span> <span class="nx">side</span><span class="err">。</span><span class="mi">1</span><span class="nx">开多</span><span class="err">，</span><span class="mi">2</span><span class="nx">开空</span><span class="err">，</span><span class="mi">3</span><span class="nx">平多</span><span class="err">，</span><span class="mi">4</span><span class="nx">平空</span>
      <span class="na">Q</span><span class="p">:</span> <span class="nx">下单数量</span>
      <span class="na">P</span><span class="p">:</span> <span class="nx">下单价格</span>
      <span class="na">S</span><span class="p">:</span> <span class="nx">订单状态</span><span class="err">。</span><span class="mi">1</span><span class="nx">未成交</span><span class="err">，</span><span class="mi">2</span><span class="nx">部分成交</span><span class="err">，</span><span class="mi">3</span><span class="nx">完全成交</span><span class="err">，</span><span class="mi">4</span><span class="nx">部分撤销</span><span class="err">，</span><span class="mi">5</span><span class="nx">全部撤销</span><span class="err">，</span><span class="mi">100</span><span class="nx">下单失败</span>
      <span class="na">r</span><span class="p">:</span> <span class="nx">失败原因</span>
      <span class="na">M</span><span class="p">:</span> <span class="nx">失败描述</span>
      <span class="na">E</span><span class="p">:</span> <span class="nx">已成交数量</span>
      <span class="na">e</span><span class="p">:</span> <span class="nx">成交均价</span>
      <span class="na">C</span><span class="p">:</span> <span class="nx">订单创建时间</span>
      <span class="na">U</span><span class="p">:</span> <span class="nx">订单更新时间</span>
      <span class="na">V</span><span class="p">:</span> <span class="nx">update</span> <span class="nx">id</span>
      <span class="na">z</span><span class="p">:</span> <span class="nx">订单冻结资产</span>
      <span class="na">rm</span><span class="p">:</span> <span class="nx">maker</span> <span class="nx">fee</span> <span class="nx">rate</span>
      <span class="na">rt</span><span class="p">:</span> <span class="nx">taker</span> <span class="nx">fee</span> <span class="nx">rate</span>
      <span class="na">of</span><span class="p">:</span> <span class="nx">订单来源</span>
      <span class="na">pid</span><span class="p">:</span> <span class="nx">对应仓位id</span>
      <span class="na">ot</span><span class="p">:</span> <span class="nx">包含止盈止损委托的下单类型</span>
      <span class="na">f</span><span class="p">:</span> <span class="nx">手续费</span>
      <span class="na">fb</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">fb0</span><span class="p">:</span> <span class="nx">抵扣手续费</span>
      <span class="na">n</span><span class="p">:</span> <span class="nx">成交笔数</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">]</span>
</code></pre></div>
<p><strong>获取ApiKey对应账户中符合下列条件的委托</strong></p>

<ol>
<li>全部未结算委托</li>
<li>三个月内的已结算委托, 含已拒绝, 已撤销和已成交委托</li>
<li>全部已成交委托</li>
<li>全部已撤销的部分成交委托</li>
</ol>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/orders</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>ids</td>
<td>string</td>
<td>否</td>
<td>委托id<br>委托id可以是交易所分配的，<br/>也可以是用户自定义的（在提交委托时使用client_order_id参数）。<br>当使用自定义id时，需要在id前添加 “c-” 前缀。<br/>例如：提交委托时使用了自定义id “123”, 在撤销委托时，需使用 “c-123”。<br/>可按以下形式指定多个委托id<br/> &quot;123,124,125,c-200&quot;</td>
</tr>
<tr>
<td>status</td>
<td>string</td>
<td>否</td>
<td>有效值 unsettled, settled<br/>unsettled 表示获取未结算委托，返回结果按委托创建时间倒序排序<br/>settled 表示获取已结算委托，返回结果按委托结算时间倒序排序<br/>默认值 unsettled</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等<br/>可按以下形式指定多个交易对代码<br/> /v4/cbu/userdata/orders?symbol=4BTC_USDT,4ETH_USDT <br/> 当 status=unsettled 时, 不指定 symbol 将返回全部交易对的未结算委托<br/>当 status=settled 时, 必须给定 symbol 参数</td>
</tr>
<tr>
<td>start_time</td>
<td>long</td>
<td>否</td>
<td>限定返回委托的最近创建时间</td>
</tr>
<tr>
<td>end_time</td>
<td>long</td>
<td>否</td>
<td>限定返回委托的最近创建时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>委托更新 id<br/>限定返回委托的最大更新id</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>委托更新 id<br/>限定返回委托的最小更新id</td>
</tr>
<tr>
<td>limit</td>
<td>long</td>
<td>否</td>
<td>指定最多返回多少个委托</td>
</tr>
</tbody></table>

<ul>
<li><p>该接口支持的参数组合和数据源</p>

<ul>
<li>ids</li>
<li>status=unsettled + symbol</li>
<li>status=settled + symbol + start_time</li>
<li>status=settled + symbol + start_time + limit</li>
<li>status=settled + symbol + end_time</li>
<li>status=settled + symbol + end_time + limit</li>
<li>status=settled + symbol + start_time + end_time</li>
<li>status=settled + symbol + start_time + end_time + limit</li>
<li>status=settled + symbol + before</li>
<li>status=settled + symbol + before + limit</li>
<li>status=settled + symbol + after</li>
<li>status=settled + symbol + after + limit</li>
</ul></li>
</ul>

<blockquote>
<p>返回的unsettled委托按创建时间由早及近排序
返回的settled委托按结算时间由早及近排序</p>
</blockquote>
<h2 id='cancel-orders'>Cancel Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">ids</span><span class="p">:</span><span class="dl">'</span><span class="s1">14244173146202090</span><span class="dl">'</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/order</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'ids'</span><span class="p">:</span> <span class="s">'14245272657638034'</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/order'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/order"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">ids</span> <span class="p">=</span> <span class="s">"15741707974869000"</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="kt">var</span> <span class="n">httpMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Delete</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
             <span class="p">};</span>

             <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">httpMessage</span><span class="p">);</span>

             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>

          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>撤销指定 id 的委托</strong></p>

<ul>
<li>请求方式 DELETE</li>
<li>请求路径 /v4/cbu/userdata/order</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>ids</td>
<td>string</td>
<td>是</td>
<td>委托id<br>委托id可以是交易所分配的，<br/>也可以是用户自定义的（在提交委托时使用client_order_id参数）。<br>当使用自定义id时，需要在id前添加 “c-” 前缀。<br/>例如：提交委托时使用了自定义id “123”, 在撤销委托时，需使用 “c-123”。<br/>可按以下形式指定多个委托id<br/> &quot;123,124,125,c-200&quot;</td>
</tr>
</tbody></table>

<blockquote>
<p>如果指定id的委托已结算，或者不存在指定id的委托，会收到-3004错误。</p>
</blockquote>
<h2 id='cancel-all-orders'>Cancel all Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">symbol</span><span class="p">:</span><span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/order</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/order'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>

    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/order"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="kt">var</span> <span class="n">httpMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Delete</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
             <span class="p">};</span>

             <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">httpMessage</span><span class="p">);</span>

             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>

          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>撤销全部委托</strong></p>

<ul>
<li>请求方式 DELETE</li>
<li>请求路径 /v4/cbu/userdata/order</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码<br/>如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
</tbody></table>

<blockquote>
<p>如果请求被正确执行，返回空对象，否则返回错误信息</p>
</blockquote>
<h2 id='get-fills'>Get fills</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">limit=2&amp;symbol=4BTC_USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/fills?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/fills'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'limit=2&amp;symbol=4BTC_USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/fills"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"limit=2&amp;symbol=4BTC_USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">i:</span><span class="w"> </span><span class="err">fill</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">o:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">s:</span><span class="w"> </span><span class="err">pair</span><span class="w">
    </span><span class="err">T:</span><span class="w"> </span><span class="err">detail</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">t:</span><span class="w"> </span><span class="err">time</span><span class="w">
    </span><span class="err">p:</span><span class="w"> </span><span class="err">price</span><span class="w">
    </span><span class="err">q:</span><span class="w"> </span><span class="err">quantity</span><span class="w">
    </span><span class="err">l:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">taker</span><span class="w">
    </span><span class="err">f:</span><span class="w"> </span><span class="err">fee</span><span class="w">
    </span><span class="err">fb:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">discount</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取成交记录</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/fills</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>order_id</td>
<td>string</td>
<td>否</td>
<td>交易所分配的委托id<br/>限定仅返回指定委托的成交记录<br/>如果不指定该参数，请指定 symbol</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码<br/>如 4BTC_USDT, 4ETH_USDT 等<br/>限定仅返回指定交易对的成交记录<br/>如果不指定该参数，请指定 order_id</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回成交记录的最早时间</td>
</tr>
<tr>
<td>end_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回成交记录的最近时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>成交记录 id<br/>限定返回成交记录的最大id</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>成交记录 id<br/>限定返回成交记录的最小id</td>
</tr>
<tr>
<td>limit</td>
<td>int32</td>
<td>否</td>
<td>限定返回结果的最大条数<br/>默认值 100</td>
</tr>
</tbody></table>

<ul>
<li><p>该接口支持的参数组合和数据源</p>

<ul>
<li>symbol  --&gt; database</li>
<li>symbol + limit  --&gt; database</li>
<li>symbol + start_time  --&gt; database</li>
<li>symbol + start_time + limit  --&gt; database</li>
<li>symbol + end_time  --&gt; database</li>
<li>symbol + end_time + limit  --&gt; database</li>
<li>symbol + start_time + end_time  --&gt; database</li>
<li>symbol + start_time + end_time + limit  --&gt; database</li>
<li>symbol + before  --&gt; database</li>
<li>symbol + before + limit  --&gt; database</li>
<li>symbol + after  --&gt; database</li>
<li>symbol + after + limit  --&gt; database</li>
<li>order_id  --&gt; database</li>
<li>order_id + limit  --&gt; database</li>
<li>order_id + before  --&gt; database</li>
<li>order_id + before + limit  --&gt; database</li>
</ul></li>
</ul>

<blockquote>
<p>返回结果按成交记录id由小到大排序</p>
</blockquote>
<h2 id='create-an-plan-order'>Create an plan order</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">side</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">plan_type</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">trigger_price</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">20000</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">book_type</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">price</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">20000</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">amount</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0.001</span><span class="dl">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/planOrders</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'open'</span><span class="p">,</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'side'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">'plan_type'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">'trigger_price'</span><span class="p">:</span> <span class="s">'20000'</span><span class="p">,</span>
        <span class="s">'book_type'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">'price'</span><span class="p">:</span> <span class="s">'20000'</span><span class="p">,</span>
        <span class="s">'amount'</span><span class="p">:</span> <span class="s">'0.001'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/planOrders'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/planOrders"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"open"</span><span class="p">,</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">side</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
                 <span class="n">plan_type</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
                 <span class="n">trigger_price</span> <span class="p">=</span> <span class="s">"20000"</span><span class="p">,</span>
                 <span class="n">book_type</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
                 <span class="n">price</span> <span class="p">=</span> <span class="s">"20000"</span><span class="p">,</span>
                 <span class="n">amount</span> <span class="p">=</span> <span class="s">"0.001"</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="err">id:</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
    </span><span class="err">s:</span><span class="w"> </span><span class="err">side</span><span class="p">,</span><span class="w">
    </span><span class="err">sid:</span><span class="w"> </span><span class="err">source</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">oid:</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">pid:</span><span class="w"> </span><span class="err">pisition</span><span class="w"> </span><span class="err">id</span><span class="w"> </span><span class="err">(分仓用)</span><span class="p">,</span><span class="w">
    </span><span class="err">q:</span><span class="w"> </span><span class="err">委托数量</span><span class="p">,</span><span class="w">
    </span><span class="err">t:</span><span class="w"> </span><span class="err">止盈止损类型</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">止盈、</span><span class="mi">2</span><span class="err">止损</span><span class="p">,</span><span class="w">
    </span><span class="err">gt:</span><span class="w"> </span><span class="err">触发方式（最新成交价触发）</span><span class="p">,</span><span class="w">
    </span><span class="err">bt:</span><span class="w"> </span><span class="err">下单方式</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="p">,</span><span class="w">
    </span><span class="err">pg:</span><span class="w"> </span><span class="err">触发价格</span><span class="p">,</span><span class="w">
    </span><span class="err">pb:</span><span class="w"> </span><span class="err">委托价格</span><span class="p">,</span><span class="w">
    </span><span class="err">st:</span><span class="w"> </span><span class="err">止盈止损订单状态。</span><span class="mi">1</span><span class="err">未触发、</span><span class="mi">2</span><span class="err">触发结束、</span><span class="mi">3</span><span class="err">取消结束、</span><span class="mi">4</span><span class="err">触发挂单失败、</span><span class="mi">5</span><span class="err">对应的止盈（或止损）委托已经触发，当前委托自动取消</span><span class="p">,</span><span class="w">
    </span><span class="err">rs:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
    </span><span class="err">rsm:</span><span class="w"> </span><span class="err">失败描述</span><span class="p">,</span><span class="w">
    </span><span class="err">bid:</span><span class="w"> </span><span class="err">委托单</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">C:</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="err">U:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">time</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>提交止盈止损委托</strong></p>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/planOrders</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>open</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>side</td>
<td>string</td>
<td>是</td>
<td>仓位方向，有效值 1多仓、2空仓</td>
</tr>
<tr>
<td>plan_type</td>
<td>string</td>
<td>是</td>
<td>止盈止损委托类型，有效值 1 止盈、2止损</td>
</tr>
<tr>
<td>trigger_price</td>
<td>decimal</td>
<td>是</td>
<td>触发价</td>
</tr>
<tr>
<td>book_type</td>
<td>int</td>
<td>是</td>
<td>委托类型，有效值 1市价止盈止损，2限价止盈止损</td>
</tr>
<tr>
<td>price</td>
<td>decimal</td>
<td>否</td>
<td>限价委托价</td>
</tr>
<tr>
<td>amount</td>
<td>decimal</td>
<td>是</td>
<td>委托数量</td>
</tr>
</tbody></table>
<h2 id='edit-an-plan-order'>Edit an plan order</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">order_id</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">book_type</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">price</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">20000</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">amount</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0.001</span><span class="dl">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/planOrders</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'change'</span><span class="p">,</span>
        <span class="s">'order_id'</span><span class="p">:</span> <span class="s">'123'</span><span class="p">,</span>
        <span class="s">'book_type'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">'price'</span><span class="p">:</span> <span class="s">'20000'</span><span class="p">,</span>
        <span class="s">'amount'</span><span class="p">:</span> <span class="s">'0.001'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/planOrders'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/planOrders"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"change"</span><span class="p">,</span>
                 <span class="n">order_id</span> <span class="p">=</span> <span class="s">"123"</span><span class="p">,</span>
                 <span class="n">book_type</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
                 <span class="n">price</span> <span class="p">=</span> <span class="s">"20000"</span><span class="p">,</span>
                 <span class="n">amount</span> <span class="p">=</span> <span class="s">"0.001"</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="err">id:</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
    </span><span class="err">s:</span><span class="w"> </span><span class="err">side</span><span class="p">,</span><span class="w">
    </span><span class="err">sid:</span><span class="w"> </span><span class="err">source</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">oid:</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
    </span><span class="err">pid:</span><span class="w"> </span><span class="err">pisition</span><span class="w"> </span><span class="err">id</span><span class="w"> </span><span class="err">(分仓用)</span><span class="p">,</span><span class="w">
    </span><span class="err">q:</span><span class="w"> </span><span class="err">委托数量</span><span class="p">,</span><span class="w">
    </span><span class="err">t:</span><span class="w"> </span><span class="err">止盈止损类型</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">止盈、</span><span class="mi">2</span><span class="err">止损</span><span class="p">,</span><span class="w">
    </span><span class="err">gt:</span><span class="w"> </span><span class="err">触发方式（最新成交价触发）</span><span class="p">,</span><span class="w">
    </span><span class="err">bt:</span><span class="w"> </span><span class="err">下单方式</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="p">,</span><span class="w">
    </span><span class="err">pg:</span><span class="w"> </span><span class="err">触发价格</span><span class="p">,</span><span class="w">
    </span><span class="err">pb:</span><span class="w"> </span><span class="err">委托价格</span><span class="p">,</span><span class="w">
    </span><span class="err">st:</span><span class="w"> </span><span class="err">止盈止损订单状态。</span><span class="mi">1</span><span class="err">未触发、</span><span class="mi">2</span><span class="err">触发结束、</span><span class="mi">3</span><span class="err">取消结束、</span><span class="mi">4</span><span class="err">触发挂单失败、</span><span class="mi">5</span><span class="err">对应的止盈（或止损）委托已经触发，当前委托自动取消</span><span class="p">,</span><span class="w">
    </span><span class="err">rs:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
    </span><span class="err">rsm:</span><span class="w"> </span><span class="err">失败描述</span><span class="p">,</span><span class="w">
    </span><span class="err">bid:</span><span class="w"> </span><span class="err">委托单</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">C:</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">time</span><span class="p">,</span><span class="w">
    </span><span class="err">U:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">time</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>修改止盈止损委托</strong></p>

<ol>
<li>只能修改委托类型+委托价格+委托数量</li>
</ol>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/planOrders</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>change</td>
</tr>
<tr>
<td>order_id</td>
<td>string</td>
<td>是</td>
<td>止盈止损委托id</td>
</tr>
<tr>
<td>book_type</td>
<td>int</td>
<td>是</td>
<td>委托类型，有效值 1市价止盈止损，2限价止盈止损</td>
</tr>
<tr>
<td>price</td>
<td>decimal</td>
<td>否</td>
<td>限价委托价</td>
</tr>
<tr>
<td>amount</td>
<td>decimal</td>
<td>是</td>
<td>委托数量</td>
</tr>
</tbody></table>
<h2 id='cancel-plan-orders'>Cancel Plan Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">ids</span><span class="p">:</span><span class="dl">'</span><span class="s1">14244173146202090</span><span class="dl">'</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/planOrders</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'ids'</span><span class="p">:</span> <span class="s">'14245272657638034'</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/planOrders'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/planOrders"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">ids</span> <span class="p">=</span> <span class="s">"15741707974869000"</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="kt">var</span> <span class="n">httpMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Delete</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
             <span class="p">};</span>

             <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">httpMessage</span><span class="p">);</span>

             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>

          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>撤销指定 id 的止盈止损委托</strong></p>

<ul>
<li>请求方式 DELETE</li>
<li>请求路径 /v4/cbu/userdata/planOrders</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>ids</td>
<td>string</td>
<td>是</td>
<td>委托id <br/>可按以下形式指定多个委托id<br/> &quot;123,124&quot;</td>
</tr>
</tbody></table>

<blockquote>
<p>如果指定id的止盈止损委托已触发，或者不存在指定id的止盈止损委托，会收到-3004错误。</p>
</blockquote>
<h2 id='cancel-all-plan-orders'>Cancel all Plan Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">symbol</span><span class="p">:</span><span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/planOrders</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/planOrders'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>

    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/planOrders"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="kt">var</span> <span class="n">httpMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Delete</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">Content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
             <span class="p">};</span>

             <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">httpMessage</span><span class="p">);</span>

             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>

          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>撤销全部止盈止损委托</strong></p>

<ul>
<li>请求方式 DELETE</li>
<li>请求路径 /v4/cbu/userdata/planOrders</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码<br/>如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
</tbody></table>

<blockquote>
<p>如果请求被正确执行，返回空对象，否则返回错误信息</p>
</blockquote>
<h2 id='get-plan-orders'>Get Plan Orders</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">limit=2&amp;status=settled&amp;symbol=4BTC_USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/planOrders?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/planOrders'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'limit=2&amp;status=settled&amp;symbol=4BTC_USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/planOrders"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"limit=2&amp;status=settled&amp;symbol=4BTC_USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="nx">plan</span> <span class="nx">order</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">m</span><span class="p">:</span> <span class="nx">pair</span>
    <span class="na">s</span><span class="p">:</span> <span class="nx">side</span><span class="p">,</span>
    <span class="na">sid</span><span class="p">:</span> <span class="nx">source</span> <span class="nx">order</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">oid</span><span class="p">:</span> <span class="nx">other</span> <span class="nx">plan</span> <span class="nx">order</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">pid</span><span class="p">:</span> <span class="nx">pisition</span> <span class="nx">id</span> <span class="p">(</span><span class="nx">分仓用</span><span class="p">),</span>
    <span class="na">q</span><span class="p">:</span> <span class="nx">委托数量</span><span class="p">,</span>
    <span class="na">t</span><span class="p">:</span> <span class="nx">止盈止损类型</span><span class="p">,</span> <span class="mi">1</span><span class="nx">止盈</span><span class="err">、</span><span class="mi">2</span><span class="nx">止损</span><span class="p">,</span>
    <span class="na">gt</span><span class="p">:</span> <span class="nx">触发方式</span><span class="err">（</span><span class="nx">最新成交价触发</span><span class="err">）</span><span class="p">,</span>
    <span class="na">bt</span><span class="p">:</span> <span class="nx">下单方式</span><span class="p">,</span> <span class="mi">1</span><span class="nx">市价</span><span class="err">，</span><span class="mi">2</span><span class="nx">限价</span>
    <span class="na">pg</span><span class="p">:</span> <span class="nx">触发价格</span><span class="p">,</span>
    <span class="na">pb</span><span class="p">:</span> <span class="nx">委托价格</span><span class="p">,</span>
    <span class="na">st</span><span class="p">:</span> <span class="nx">止盈止损订单状态</span><span class="err">。</span><span class="mi">1</span><span class="nx">未触发</span><span class="err">、</span><span class="mi">2</span><span class="nx">触发结束</span><span class="err">、</span><span class="mi">3</span><span class="nx">取消结束</span><span class="err">、</span><span class="mi">4</span><span class="nx">触发挂单失败</span><span class="err">、</span><span class="mi">5</span><span class="nx">对应的止盈</span><span class="err">（</span><span class="nx">或止损</span><span class="err">）</span><span class="nx">委托已经触发</span><span class="err">，</span><span class="nx">当前委托自动取消</span><span class="p">,</span>
    <span class="na">rs</span><span class="p">:</span> <span class="nx">失败原因</span>
    <span class="na">rsm</span><span class="p">:</span> <span class="nx">失败描述</span><span class="p">,</span>
    <span class="na">bid</span><span class="p">:</span> <span class="nx">委托单</span> <span class="nx">order</span> <span class="nx">id</span>
    <span class="na">V</span><span class="p">:</span> <span class="nx">update</span> <span class="nx">id</span>
    <span class="na">C</span><span class="p">:</span> <span class="nx">create</span> <span class="nx">time</span><span class="p">,</span>
    <span class="na">U</span><span class="p">:</span> <span class="nx">update</span> <span class="nx">time</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">]</span>
</code></pre></div>
<p><strong>获取ApiKey对应账户中符合下列条件的止盈止损委托</strong></p>

<ol>
<li>全部未触发止盈止损委托</li>
<li>三个月内的止盈止损委托, 含撤销和已触发的</li>
<li>全部已触发止盈止损委托</li>
</ol>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/planOrders</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>ids</td>
<td>string</td>
<td>否</td>
<td>委托id<br>委托id可以是交易所分配的，<br/> 可按以下形式指定多个委托id<br/> &quot;123,124,125&quot;</td>
</tr>
<tr>
<td>status</td>
<td>string</td>
<td>否</td>
<td>有效值 unsettled, settled<br/>unsettled 表示获取未触发止盈止损委托，返回结果按委托创建时间倒序排序<br/>settled 表示获取已触发止盈止损委托，返回结果按委托触发时间倒序排序<br/>默认值 unsettled</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等<br/>可按以下形式指定多个交易对代码<br/> /v4/cbu/userdata/orders?symbol=4BTC_USDT,4ETH_USDT <br/> 当 status=unsettled 时, 不指定 symbol 将返回全部交易对的未结算委托<br/>当 status=settled 时, 必须给定 symbol 参数</td>
</tr>
<tr>
<td>start_time</td>
<td>long</td>
<td>否</td>
<td>限定返回委托的最近创建时间</td>
</tr>
<tr>
<td>end_time</td>
<td>long</td>
<td>否</td>
<td>限定返回委托的最近创建时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>委托更新 id<br/>限定返回委托的最大更新id</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>委托更新 id<br/>限定返回委托的最小更新id</td>
</tr>
<tr>
<td>limit</td>
<td>long</td>
<td>否</td>
<td>指定最多返回多少个委托</td>
</tr>
</tbody></table>

<ul>
<li><p>该接口支持的参数组合和数据源</p>

<ul>
<li>ids</li>
<li>status=unsettled + symbol</li>
<li>status=settled + symbol + start_time</li>
<li>status=settled + symbol + start_time + limit</li>
<li>status=settled + symbol + end_time</li>
<li>status=settled + symbol + end_time + limit</li>
<li>status=settled + symbol + start_time + end_time</li>
<li>status=settled + symbol + start_time + end_time + limit</li>
<li>status=settled + symbol + before</li>
<li>status=settled + symbol + before + limit</li>
<li>status=settled + symbol + after</li>
<li>status=settled + symbol + after + limit</li>
</ul></li>
</ul>

<blockquote>
<p>返回的unsettled委托按创建时间由早及近排序
返回的settled委托按结算时间由早及近排序</p>
</blockquote>
<h2 id='get-positions'>Get Positions</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">symbol=4BTC_USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/positions?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/positions'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'symbol=4BTC_USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/positions"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"symbol=4BTC_USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="nx">position</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">ui</span><span class="p">:</span> <span class="nx">user</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">v</span><span class="p">:</span> <span class="nx">version</span><span class="p">,</span>
    <span class="na">m</span><span class="p">:</span> <span class="nx">pair</span> <span class="nx">symbol</span><span class="p">,</span>
    <span class="na">st</span><span class="p">:</span> <span class="nx">status</span><span class="p">,</span>
    <span class="na">sp</span><span class="p">:</span> <span class="nx">separate</span><span class="p">,</span>
    <span class="na">sd</span><span class="p">:</span> <span class="nx">side</span><span class="err">。</span><span class="mi">1</span><span class="nx">多仓</span><span class="err">，</span><span class="mi">2</span><span class="nx">空仓</span><span class="p">,</span>
    <span class="na">md</span><span class="p">:</span> <span class="nx">model</span><span class="err">。</span><span class="mi">1</span><span class="nx">全仓</span><span class="err">，</span><span class="mi">2</span><span class="nx">逐仓</span><span class="err">，</span><span class="mi">3</span><span class="nx">全仓分仓</span><span class="err">，</span><span class="mi">4</span><span class="nx">逐仓分仓</span><span class="p">,</span>
    <span class="na">l</span><span class="p">:</span> <span class="nx">leverage</span><span class="p">,</span>
    <span class="na">mg</span><span class="p">:</span> <span class="nx">margin</span><span class="p">,</span>
    <span class="na">hc</span><span class="p">:</span> <span class="nx">hold</span> <span class="nx">coin</span><span class="p">,</span>
    <span class="na">po</span><span class="p">:</span> <span class="nx">price</span> <span class="nx">open</span><span class="p">,</span>
    <span class="na">pa</span><span class="p">:</span> <span class="nx">price</span> <span class="nx">alert</span><span class="p">,</span>
    <span class="na">pf</span><span class="p">:</span> <span class="nx">price</span> <span class="nx">force</span><span class="p">,</span>
    <span class="na">pt</span><span class="p">:</span> <span class="nx">profit</span><span class="p">,</span>
    <span class="na">f</span><span class="p">:</span> <span class="nx">fee</span><span class="p">,</span>
    <span class="na">fb</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">fb0</span><span class="p">:</span> <span class="nx">fee</span> <span class="nx">bix0</span><span class="p">,</span>
    <span class="na">ps</span><span class="p">:</span> <span class="nx">止损单数量</span><span class="p">,</span>
    <span class="na">pp</span><span class="p">:</span> <span class="nx">止盈单数量</span><span class="p">,</span>
    <span class="na">lc</span><span class="p">:</span> <span class="nx">剩余可平数量</span><span class="p">,</span>
    <span class="na">cc</span><span class="p">:</span> <span class="nx">已平仓数量</span><span class="err">（</span><span class="nx">分仓会记录</span><span class="err">）</span><span class="p">,</span>
    <span class="na">pc</span><span class="p">:</span> <span class="nx">平仓均价</span><span class="err">（</span><span class="nx">分仓会记录</span><span class="err">）</span><span class="p">,</span>
    <span class="na">C</span><span class="p">:</span> <span class="nx">创建时间</span><span class="p">,</span>
    <span class="na">ud</span><span class="p">:</span> <span class="nx">update</span> <span class="nx">id</span><span class="p">,</span>
    <span class="na">U</span><span class="p">:</span> <span class="nx">更新时间</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">]</span>
</code></pre></div>
<p><strong>获取ApiKey对应账户的仓位</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/positions</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码，如 4BTC_USDT, 4ETH_USDT 等</td>
</tr>
<tr>
<td>side</td>
<td>int</td>
<td>否</td>
<td>仓位方向，当symbol有效时，side才有效</td>
</tr>
</tbody></table>
<h2 id='change-position-mode'>Change Position Mode</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">changeMode</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">mode</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">leverage_long</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">leverage_short</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4</span><span class="dl">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/positions</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'changeMode'</span><span class="p">,</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'mode'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">'leverage_long'</span><span class="p">:</span> <span class="s">'2'</span><span class="p">,</span>
        <span class="s">'leverage_short'</span><span class="p">:</span> <span class="s">'4'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/positions'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/positions"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"changeMode"</span><span class="p">,</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">mode</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
                 <span class="n">plan_type</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
                 <span class="n">leverage_long</span> <span class="p">=</span> <span class="s">"2"</span><span class="p">,</span>
                 <span class="n">leverage_short</span> <span class="p">=</span> <span class="s">"4"</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>修改仓位模式</strong></p>

<ol>
<li>逐仓全仓模式切换</li>
<li>杠杆倍数调整</li>
</ol>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/positions</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>changeMode</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对</td>
</tr>
<tr>
<td>mode</td>
<td>int</td>
<td>是</td>
<td>仓位模式，有效值 1全仓，2逐仓</td>
</tr>
<tr>
<td>leverage_long</td>
<td>int</td>
<td>是</td>
<td>多仓杠杆倍数</td>
</tr>
<tr>
<td>leverage_short</td>
<td>int</td>
<td>是</td>
<td>空仓杠杆倍数，全仓模式模式下，该值应该等于 leverage_long</td>
</tr>
</tbody></table>
<h2 id='change-position-margin'>Change Position Margin</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">changeMargin</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">side</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">margin</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/positions</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'changeMargin'</span><span class="p">,</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'side'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">'margin'</span><span class="p">:</span> <span class="s">'2'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/positions'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/positions"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"changeMargin"</span><span class="p">,</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">side</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
                 <span class="n">margin</span> <span class="p">=</span> <span class="s">"2"</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>调整仓位保证金</strong></p>

<ol>
<li>逐仓模式才可以修改</li>
</ol>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/positions</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>changeMargin</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对</td>
</tr>
<tr>
<td>side</td>
<td>int</td>
<td>是</td>
<td>仓位方向，有效值 1多仓，2空仓</td>
</tr>
<tr>
<td>margin</td>
<td>Decimal</td>
<td>是</td>
<td>保证金调整数量</td>
</tr>
</tbody></table>
<h2 id='clear-position-hold'>Clear Position Hold</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">clear</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">side</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/positions</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'clear'</span><span class="p">,</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'side'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/positions'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/positions"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"clear"</span><span class="p">,</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">side</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>平掉仓位所有持仓</strong></p>

<ol>
<li>以市价快速平仓</li>
<li>极端行情下，可能存在对手单不足导致无法全部平仓的情况</li>
<li>平仓价不会超出爆仓价范围</li>
</ol>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/positions</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>clear</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对</td>
</tr>
<tr>
<td>side</td>
<td>int</td>
<td>否</td>
<td>仓位方向，有效值 1多仓，2空仓 <br/> 当symbol 有效时，side才有效</td>
</tr>
</tbody></table>

<ul>
<li><p>该接口支持的参数组合和数据源</p>

<ul>
<li>cmd=clear --&gt; 平掉所有仓位持仓</li>
<li>cmd=clear + symbol --&gt; 平掉指定交易对所有持仓</li>
<li>cmd=clear + symbol + side --&gt; 平掉指定交易对指定仓位持仓</li>
</ul></li>
</ul>
<h2 id='oppose-position'>Oppose Position</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">oppose</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">4BTC_USDT</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">side</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/positions</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="nx">url</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span><span class="nx">param</span><span class="p">,</span>
        <span class="na">json</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>  <span class="c1">// optional</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'cmd'</span><span class="p">:</span> <span class="s">'oppose'</span><span class="p">,</span>
        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'4BTC_USDT'</span><span class="p">,</span>
        <span class="s">'side'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">body_str</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">body_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/positions'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SortContractResolver</span> <span class="p">:</span> <span class="n">DefaultContractResolver</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="nf">CreateProperties</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">MemberSerialization</span> <span class="n">memberSerialization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IList</span><span class="p">&lt;</span><span class="n">JsonProperty</span><span class="p">&gt;</span> <span class="n">properties</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="nf">CreateProperties</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">memberSerialization</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">properties</span><span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/positions"</span><span class="p">;</span>

             <span class="kt">var</span> <span class="n">myobj</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span>
                 <span class="n">cmd</span> <span class="p">=</span> <span class="s">"oppose"</span><span class="p">,</span>
                 <span class="n">symbol</span> <span class="p">=</span> <span class="s">"4BTC_USDT"</span><span class="p">,</span>
                 <span class="n">side</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
             <span class="p">};</span>

             <span class="kt">string</span> <span class="n">body_str</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="k">new</span> <span class="n">JsonSerializerSettings</span> <span class="p">{</span> <span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SortContractResolver</span><span class="p">()</span> <span class="p">});</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">body_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign_str</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="n">body_str</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>反方向开仓</strong></p>

<ol>
<li>以市价快速平掉当前持仓</li>
<li>以市价快速反方向开仓</li>
<li>开仓价、平仓价不允许超出爆仓价范围</li>
<li>极端行情下，可能会出现平仓不能完全成交的情况，这种情况下将不会继续平仓，也不会继续开仓</li>
<li>极端行情下，可能会出现开仓不能完全成交的情况，这种情况下将不会继续开仓</li>
</ol>

<ul>
<li>请求方式 POST</li>
<li>请求路径 /v4/cbu/userdata/positions</li>
<li>权限: Trade</li>
<li>请求参数</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>cmd</td>
<td>string</td>
<td>是</td>
<td>oppose</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>是</td>
<td>交易对</td>
</tr>
<tr>
<td>side</td>
<td>int</td>
<td>是</td>
<td>仓位方向，有效值 1多仓，2空仓</td>
</tr>
</tbody></table>
<h2 id='get-position-logs'>Get Position Logs</h2>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">let</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">endpoints</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://api.bibox.com/api</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e03e8fda27b6e4fc6b29bb244747dcf64092996</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b825a03636ca09c884ca11d71cfc4217a98cb8bf</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>


<span class="kd">const</span> <span class="nx">queryStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">limit=2&amp;symbol=4BTC_USDT</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">signStr</span> <span class="o">=</span> <span class="nx">expireTime</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">queryStr</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">signStr</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoints</span><span class="p">}</span><span class="err">/v4/cbu/userdata/dealLog?</span><span class="p">${</span><span class="nx">queryStr</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Key</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Api-Sign</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="kd">function</span> <span class="nx">optionalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="c1">// 7.the result</span>

    <span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">END_POINT</span> <span class="o">=</span> <span class="s">'https://api.bibox.com/api'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'9e03e8fda27b6e4fc6b29bb244747dcf64092996'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'b825a03636ca09c884ca11d71cfc4217a98cb8bf'</span>


<span class="k">def</span> <span class="nf">do_request</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/v4/cbu/userdata/dealLog'</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s">'limit=2&amp;symbol=4BTC_USDT'</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">':'</span> <span class="o">+</span> <span class="n">query_str</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Key'</span><span class="p">:</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'Bibox-Api-Sign'</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time'</span><span class="p">:</span> <span class="n">expireTime</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">END_POINT</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">do_request</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleProgram</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
          <span class="k">try</span>
          <span class="p">{</span>
             <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">endpoints</span> <span class="p">=</span> <span class="s">"https://api.bibox.com/api"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"/v4/cbu/userdata/dealLog"</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">query_str</span> <span class="p">=</span> <span class="s">"limit=2&amp;symbol=4BTC_USDT"</span><span class="p">;</span>

             <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>
             <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
             <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">endpoints</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">query_str</span><span class="p">;</span>

             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
             <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

             <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
             <span class="n">response</span><span class="p">.</span><span class="nf">EnsureSuccessStatusCode</span><span class="p">();</span>
             <span class="kt">string</span> <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>

             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">responseBody</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">catch</span><span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">e</span><span class="p">)</span>
          <span class="p">{</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nException Caught!"</span><span class="p">);</span>
             <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Message :{0} "</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<blockquote>
<p>Response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">i:</span><span class="w"> </span><span class="err">'</span><span class="mi">1125899906843599056</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">deal</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">id</span><span class="w">
    </span><span class="err">m:</span><span class="w"> </span><span class="err">'</span><span class="mi">4</span><span class="err">STEPN_USDT'</span><span class="p">,</span><span class="w"> </span><span class="err">pair</span><span class="w">
    </span><span class="err">y:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">deal</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">type.</span><span class="w"> </span><span class="mi">1</span><span class="err">开仓，</span><span class="mi">2</span><span class="err">平仓，</span><span class="mi">3</span><span class="err">减仓降低风险等级</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="err">爆仓清空仓位</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="err">ADL</span><span class="w">
    </span><span class="err">p:</span><span class="w"> </span><span class="err">'</span><span class="mi">1125899906842624053</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">仓位id</span><span class="w">
    </span><span class="err">sd:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">仓位方向，</span><span class="mi">1</span><span class="err">多仓，</span><span class="mi">2</span><span class="err">空仓</span><span class="w">
    </span><span class="err">md:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">仓位模式，</span><span class="mi">1</span><span class="err">全仓，</span><span class="mi">2</span><span class="err">逐仓，</span><span class="mi">3</span><span class="err">全仓分仓，</span><span class="mi">4</span><span class="err">逐仓分仓</span><span class="w">
    </span><span class="err">hc:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="err">持仓数量</span><span class="w">
    </span><span class="err">hd:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="err">持仓改变量</span><span class="w">
    </span><span class="err">o:</span><span class="w"> </span><span class="mf">1.3592983336</span><span class="p">,</span><span class="w"> </span><span class="err">开仓均价</span><span class="w">
    </span><span class="err">pl:</span><span class="w"> </span><span class="mf">1.3336</span><span class="p">,</span><span class="w"> </span><span class="err">用到的价格</span><span class="w">
    </span><span class="err">fi:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">盈利</span><span class="w">
    </span><span class="err">f:</span><span class="w"> </span><span class="mf">0.0106688</span><span class="p">,</span><span class="w"> </span><span class="err">手续费</span><span class="w">
    </span><span class="err">fb:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">优惠券抵扣手续费</span><span class="w">
    </span><span class="err">t:</span><span class="w"> </span><span class="mi">1653541169000</span><span class="w"> </span><span class="err">时间</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>获取成交记录</strong></p>

<ul>
<li>请求方式 GET</li>
<li>请求路径 /v4/cbu/userdata/dealLog</li>
<li>权限: View, Trade</li>
<li>请求参数(需要排序)</li>
</ul>

<table><thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必传</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>symbol</td>
<td>string</td>
<td>否</td>
<td>交易对代码<br/>如 4BTC_USDT, 4ETH_USDT 等<br/>限定仅返回指定交易对的成交记录<br/>如果不指定该参数，请指定 order_id</td>
</tr>
<tr>
<td>start_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回成交记录的最早时间</td>
</tr>
<tr>
<td>end_time</td>
<td>int64</td>
<td>否</td>
<td>限定返回成交记录的最近时间</td>
</tr>
<tr>
<td>before</td>
<td>int64</td>
<td>否</td>
<td>成交记录 id<br/>限定返回成交记录的最大id</td>
</tr>
<tr>
<td>after</td>
<td>int64</td>
<td>否</td>
<td>成交记录 id<br/>限定返回成交记录的最小id</td>
</tr>
<tr>
<td>limit</td>
<td>int32</td>
<td>否</td>
<td>限定返回结果的最大条数<br/>默认值 100</td>
</tr>
</tbody></table>

<ul>
<li><p>该接口支持的参数组合和数据源</p>

<ul>
<li>symbol  --&gt; database</li>
<li>symbol + limit  --&gt; database</li>
<li>symbol + start_time  --&gt; database</li>
<li>symbol + start_time + limit  --&gt; database</li>
<li>symbol + end_time  --&gt; database</li>
<li>symbol + end_time + limit  --&gt; database</li>
<li>symbol + start_time + end_time  --&gt; database</li>
<li>symbol + start_time + end_time + limit  --&gt; database</li>
<li>symbol + before  --&gt; database</li>
<li>symbol + before + limit  --&gt; database</li>
<li>symbol + after  --&gt; database</li>
<li>symbol + after + limit  --&gt; database</li>
</ul></li>
</ul>
<h1 id='user-data-streams'>User Data Streams</h1><h2 id='overview-2'>Overview</h2>
<blockquote>
<p>例子</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">biboxws</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">wss://user-wss.bibox360.com/cbu</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">9e2bd17ff73e8531c0f3c26f93e48bfa402a3b13</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your apikey</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ca55beb9e45d4f30b3959b464402319b9e12bac7</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// your secret</span>

<span class="kd">let</span> <span class="nx">wsClass</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>


<span class="nx">wsClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_initWs</span> <span class="o">=</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">biboxws</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">expireTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20000</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">sign</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="dl">""</span> <span class="o">+</span> <span class="nx">expireTime</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">biboxws</span><span class="p">,</span><span class="dl">""</span><span class="p">,{</span><span class="na">headers</span><span class="p">:{</span>
      <span class="dl">'</span><span class="s1">BIBOX-API-KEY</span><span class="dl">'</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">BIBOX-API-SIGN</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sign</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Bibox-Expire-Time</span><span class="dl">'</span><span class="p">:</span> <span class="nx">expireTime</span><span class="p">,</span>
    <span class="p">}});</span>
  <span class="nx">that</span><span class="p">.</span><span class="nx">ws</span> <span class="o">=</span> <span class="nx">ws</span><span class="p">;</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">open</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">ws</span><span class="p">.</span><span class="nx">ping</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span>
    <span class="p">},</span><span class="mi">30000</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">close, </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span>  <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error </span><span class="dl">'</span><span class="p">,</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ping </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">pong</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">pong </span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="c1">// the data may be is error message,check the data's stream is order or account</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wsClass</span><span class="p">();</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">_initWs</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">ws_url</span> <span class="o">=</span> <span class="s">'wss://user-wss.bibox360.com/cbu'</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s">'900625568558820892a8c833c33ebc8fd2701efe'</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'c708ac3e70d115ec29efbee197330627d7edf842'</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"### closed ###"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_open</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"### opened ###"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="c1"># websocket.enableTrace(True)
</span>
    <span class="n">expireTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">20000</span>
    <span class="n">sign_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expireTime</span><span class="p">)</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">sign_str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">'BIBOX-API-KEY:'</span> <span class="o">+</span> <span class="n">API_KEY</span><span class="p">,</span>
        <span class="s">'BIBOX-API-SIGN:'</span> <span class="o">+</span> <span class="n">sign</span><span class="p">,</span>
        <span class="s">'Bibox-Expire-Time:'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">expireTime</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="p">.</span><span class="n">WebSocketApp</span><span class="p">(</span><span class="n">ws_url</span><span class="p">,</span>
                                <span class="n">on_open</span><span class="o">=</span><span class="n">on_open</span><span class="p">,</span>
                                <span class="n">on_message</span><span class="o">=</span><span class="n">on_message</span><span class="p">,</span>
                                <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
                                <span class="n">on_close</span><span class="o">=</span><span class="n">on_close</span><span class="p">,</span>
                                <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">on_open</span> <span class="o">=</span> <span class="n">on_open</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">run_forever</span><span class="p">(</span><span class="n">ping_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ping_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">connect</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.WebSockets</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO.Compression</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Send</span><span class="p">(</span><span class="n">ClientWebSocket</span> <span class="n">ws</span><span class="p">,</span> <span class="kt">string</span> <span class="n">data</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="k">await</span> <span class="n">ws</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">WebSocketMessageType</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="n">CancellationToken</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Receive</span><span class="p">(</span><span class="n">ClientWebSocket</span> <span class="n">ws</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;(</span><span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">2048</span><span class="p">]);</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="n">WebSocketReceiveResult</span> <span class="n">result</span><span class="p">;</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ms</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="k">do</span>
                    <span class="p">{</span>
                        <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">ws</span><span class="p">.</span><span class="nf">ReceiveAsync</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">CancellationToken</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
                        <span class="n">ms</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Offset</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">while</span> <span class="p">(!</span><span class="n">result</span><span class="p">.</span><span class="n">EndOfMessage</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">MessageType</span> <span class="p">==</span> <span class="n">WebSocketMessageType</span><span class="p">.</span><span class="n">Close</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="n">ms</span><span class="p">.</span><span class="nf">Seek</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">SeekOrigin</span><span class="p">.</span><span class="n">Begin</span><span class="p">);</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">))</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="k">await</span> <span class="n">reader</span><span class="p">.</span><span class="nf">ReadToEndAsync</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">tmwindow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TimeSpan</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt64</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">+</span> <span class="n">tmwindow</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">string</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmacmd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">inArray</span> <span class="p">=</span> <span class="n">hmacmd</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">inArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">inArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"X2"</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="n">hmacmd</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span> <span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">apikey</span> <span class="p">=</span> <span class="s">"900625568558820892a8c833c33ebc8fd2701efe"</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">secret</span> <span class="p">=</span> <span class="s">"c708ac3e70d115ec29efbee197330627d7edf842"</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">wsuri</span> <span class="p">=</span> <span class="s">"wss://user-wss.bibox360.com/cbu"</span><span class="p">;</span>

            <span class="kt">string</span> <span class="n">expireTime</span> <span class="p">=</span> <span class="nf">GetExpireTime</span><span class="p">(</span><span class="m">20000</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">sign_str</span> <span class="p">=</span> <span class="n">expireTime</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">sign</span> <span class="p">=</span> <span class="nf">HmacSha256</span><span class="p">(</span><span class="n">sign_str</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>

            <span class="k">do</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ws</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ClientWebSocket</span><span class="p">())</span>
                    <span class="k">try</span>
                    <span class="p">{</span>
                        <span class="n">ws</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="nf">SetRequestHeader</span><span class="p">(</span><span class="s">"Bibox-Api-Key"</span><span class="p">,</span> <span class="n">apikey</span><span class="p">);</span>
                        <span class="n">ws</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="nf">SetRequestHeader</span><span class="p">(</span><span class="s">"Bibox-Api-Sign"</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
                        <span class="n">ws</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="nf">SetRequestHeader</span><span class="p">(</span><span class="s">"Bibox-Expire-Time"</span><span class="p">,</span> <span class="n">expireTime</span><span class="p">);</span>

                        <span class="k">await</span> <span class="n">ws</span><span class="p">.</span><span class="nf">ConnectAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">wsuri</span><span class="p">),</span> <span class="n">CancellationToken</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>

                        <span class="k">await</span> <span class="nf">Receive</span><span class="p">(</span><span class="n">ws</span><span class="p">);</span>

                    <span class="p">}</span>
                    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"ERROR - </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                    <span class="p">}</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
<p>使用 Websocket 推送服务可以及时获取账户的余额、委托、仓位及止盈止损委托变动信息。</p>

<p><strong>连接 Websocket 服务器</strong></p>

<p>请使用以下 URL 连接 Websocket 服务器：</p>

<p>wss://user-wss.bibox360.com/cbu</p>

<p><strong>在连接时，请附加以下HTTP请求头</strong></p>

<ul>
<li>BIBOX-API-KEY</li>
<li>BIBOX-API-SIGN</li>
<li>Bibox-Expire-Time</li>
</ul>

<p><em>具体方法请参考<a href="#authentication">Authentication</a>章节</em></p>

<blockquote>
<p>数据流
在成功建立连接后，客户端将收到ApiKey对应账户的余额变动信息及委托变动信息。格式如下:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">Account</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"position"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">Position</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">Order</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"stream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"planOrder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">Plan</span><span class="w"> </span><span class="err">Order</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='account'>Account</h2>
<p><strong>当账户余额发生变更时，会收到account事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">c:</span><span class="w"> </span><span class="err">'USDT'</span><span class="p">,</span><span class="w"> </span><span class="err">币种符号</span><span class="w">
        </span><span class="err">b:</span><span class="w"> </span><span class="err">'</span><span class="mf">8247.1187293513</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">账户可用余额</span><span class="w">
        </span><span class="err">ff:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">逐仓挂单冻结</span><span class="w">
        </span><span class="err">fc:</span><span class="w"> </span><span class="err">'</span><span class="mf">346.73844114</span><span class="err">'</span><span class="p">,</span><span class="err">全仓挂单冻结</span><span class="w">
        </span><span class="err">mf:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="err">逐仓保证金</span><span class="w">
        </span><span class="err">mc:</span><span class="w"> </span><span class="err">'</span><span class="mf">1396.55822362</span><span class="err">'</span><span class="p">,</span><span class="err">全仓保证金</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='orders'>Orders</h2>
<p><strong>当委托发生变更时，会收到order事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"order"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">i:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">I:</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
        </span><span class="err">T:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">type。</span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="w">
        </span><span class="err">s:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">side。</span><span class="mi">1</span><span class="err">开多，</span><span class="mi">2</span><span class="err">开空，</span><span class="mi">3</span><span class="err">平多，</span><span class="mi">4</span><span class="err">平空</span><span class="w">
        </span><span class="err">Q:</span><span class="w"> </span><span class="err">下单数量</span><span class="w">
        </span><span class="err">P:</span><span class="w"> </span><span class="err">下单价格</span><span class="w">
        </span><span class="err">S:</span><span class="w"> </span><span class="err">订单状态。</span><span class="mi">1</span><span class="err">未成交，</span><span class="mi">2</span><span class="err">部分成交，</span><span class="mi">3</span><span class="err">完全成交，</span><span class="mi">4</span><span class="err">部分撤销，</span><span class="mi">5</span><span class="err">全部撤销，</span><span class="mi">100</span><span class="err">下单失败</span><span class="w">
        </span><span class="err">r:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
        </span><span class="err">M:</span><span class="w"> </span><span class="err">失败描述</span><span class="w">
        </span><span class="err">E:</span><span class="w"> </span><span class="err">已成交数量</span><span class="w">
        </span><span class="err">e:</span><span class="w"> </span><span class="err">成交均价</span><span class="w">
        </span><span class="err">C:</span><span class="w"> </span><span class="err">订单创建时间</span><span class="w">
        </span><span class="err">U:</span><span class="w"> </span><span class="err">订单更新时间</span><span class="w">
        </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">z:</span><span class="w"> </span><span class="err">订单冻结资产</span><span class="w">
        </span><span class="err">rm:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
        </span><span class="err">rt:</span><span class="w"> </span><span class="err">taker</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">rate</span><span class="w">
        </span><span class="err">of:</span><span class="w"> </span><span class="err">订单来源</span><span class="w">
        </span><span class="err">pid:</span><span class="w"> </span><span class="err">对应仓位id</span><span class="w">
        </span><span class="err">ot:</span><span class="w"> </span><span class="err">包含止盈止损委托的下单类型</span><span class="w">
        </span><span class="err">f:</span><span class="w"> </span><span class="err">手续费</span><span class="w">
        </span><span class="err">fb:</span><span class="w"> </span><span class="err">'</span><span class="mi">0</span><span class="err">'</span><span class="p">,</span><span class="w">
        </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">抵扣手续费</span><span class="w">
        </span><span class="err">n:</span><span class="w"> </span><span class="err">成交笔数</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='positions'>Positions</h2>
<p><strong>当仓位发生变更时，会收到position事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"position"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">id:</span><span class="w"> </span><span class="err">position</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">ui:</span><span class="w"> </span><span class="err">user</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">v:</span><span class="w"> </span><span class="err">version</span><span class="p">,</span><span class="w">
        </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w"> </span><span class="err">symbol</span><span class="p">,</span><span class="w">
        </span><span class="err">st:</span><span class="w"> </span><span class="err">status</span><span class="p">,</span><span class="w">
        </span><span class="err">sp:</span><span class="w"> </span><span class="err">separate</span><span class="p">,</span><span class="w">
        </span><span class="err">sd:</span><span class="w"> </span><span class="err">side。</span><span class="mi">1</span><span class="err">多仓，</span><span class="mi">2</span><span class="err">空仓</span><span class="p">,</span><span class="w">
        </span><span class="err">md:</span><span class="w"> </span><span class="err">model。</span><span class="mi">1</span><span class="err">全仓，</span><span class="mi">2</span><span class="err">逐仓，</span><span class="mi">3</span><span class="err">全仓分仓，</span><span class="mi">4</span><span class="err">逐仓分仓</span><span class="p">,</span><span class="w">
        </span><span class="err">l:</span><span class="w"> </span><span class="err">leverage</span><span class="p">,</span><span class="w">
        </span><span class="err">mg:</span><span class="w"> </span><span class="err">margin</span><span class="p">,</span><span class="w">
        </span><span class="err">hc:</span><span class="w"> </span><span class="err">hold</span><span class="w"> </span><span class="err">coin</span><span class="p">,</span><span class="w">
        </span><span class="err">po:</span><span class="w"> </span><span class="err">price</span><span class="w"> </span><span class="err">open</span><span class="p">,</span><span class="w">
        </span><span class="err">pa:</span><span class="w"> </span><span class="err">price</span><span class="w"> </span><span class="err">alert</span><span class="p">,</span><span class="w">
        </span><span class="err">pf:</span><span class="w"> </span><span class="err">price</span><span class="w"> </span><span class="err">force</span><span class="p">,</span><span class="w">
        </span><span class="err">pt:</span><span class="w"> </span><span class="err">profit</span><span class="p">,</span><span class="w">
        </span><span class="err">f:</span><span class="w"> </span><span class="err">fee</span><span class="p">,</span><span class="w">
        </span><span class="err">fb:</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">bix</span><span class="p">,</span><span class="w">
        </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">bix</span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="err">ps:</span><span class="w"> </span><span class="err">止损单数量</span><span class="p">,</span><span class="w">
        </span><span class="err">pp:</span><span class="w"> </span><span class="err">止盈单数量</span><span class="p">,</span><span class="w">
        </span><span class="err">lc:</span><span class="w"> </span><span class="err">剩余可平数量</span><span class="p">,</span><span class="w">
        </span><span class="err">cc:</span><span class="w"> </span><span class="err">已平仓数量（分仓会记录）</span><span class="p">,</span><span class="w">
        </span><span class="err">pc:</span><span class="w"> </span><span class="err">平仓均价（分仓会记录）</span><span class="p">,</span><span class="w">
        </span><span class="err">C:</span><span class="w"> </span><span class="err">创建时间</span><span class="p">,</span><span class="w">
        </span><span class="err">ud:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">U:</span><span class="w"> </span><span class="err">更新时间</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='plan-orders'>Plan Orders</h2>
<p><strong>当止盈止损委托发生变更时，会收到 planOrder 事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"planOrder"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">id:</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">m:</span><span class="w"> </span><span class="err">pair</span><span class="w">
        </span><span class="err">s:</span><span class="w"> </span><span class="err">side</span><span class="p">,</span><span class="w">
        </span><span class="err">sid:</span><span class="w"> </span><span class="err">source</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">oid:</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">plan</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">pid:</span><span class="w"> </span><span class="err">pisition</span><span class="w"> </span><span class="err">id</span><span class="w"> </span><span class="err">(分仓用)</span><span class="p">,</span><span class="w">
        </span><span class="err">q:</span><span class="w"> </span><span class="err">委托数量</span><span class="p">,</span><span class="w">
        </span><span class="err">t:</span><span class="w"> </span><span class="err">止盈止损类型</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">止盈、</span><span class="mi">2</span><span class="err">止损</span><span class="w">
        </span><span class="err">gt:</span><span class="w"> </span><span class="err">触发方式（最新成交价触发）</span><span class="p">,</span><span class="w">
        </span><span class="err">bt:</span><span class="w"> </span><span class="err">下单方式</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">市价，</span><span class="mi">2</span><span class="err">限价</span><span class="p">,</span><span class="w">
        </span><span class="err">pg:</span><span class="w"> </span><span class="err">触发价格</span><span class="p">,</span><span class="w">
        </span><span class="err">pb:</span><span class="w"> </span><span class="err">委托价格</span><span class="p">,</span><span class="w">
        </span><span class="err">st:</span><span class="w"> </span><span class="err">止盈止损订单状态。</span><span class="mi">1</span><span class="err">未触发、</span><span class="mi">2</span><span class="err">触发结束、</span><span class="mi">3</span><span class="err">取消结束、</span><span class="mi">4</span><span class="err">触发挂单失败、</span><span class="mi">5</span><span class="err">对应的止盈（或止损）委托已经触发，当前委托自动取消</span><span class="p">,</span><span class="w">
        </span><span class="err">rs:</span><span class="w"> </span><span class="err">失败原因</span><span class="w">
        </span><span class="err">rsm:</span><span class="w"> </span><span class="err">失败描述</span><span class="p">,</span><span class="w">
        </span><span class="err">bid:</span><span class="w"> </span><span class="err">委托单</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">V:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">C:</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">time</span><span class="p">,</span><span class="w">
        </span><span class="err">U:</span><span class="w"> </span><span class="err">update</span><span class="w"> </span><span class="err">time</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='fills'>Fills</h2>
<p><strong>当委托发生成交时，会收到 fill 事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"fill"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">i:</span><span class="w"> </span><span class="err">fill</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">o:</span><span class="w"> </span><span class="err">order</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">s:</span><span class="w"> </span><span class="err">pair</span><span class="w">
        </span><span class="err">T:</span><span class="w"> </span><span class="err">detail</span><span class="w"> </span><span class="err">id</span><span class="p">,</span><span class="w">
        </span><span class="err">t:</span><span class="w"> </span><span class="err">time</span><span class="w">
        </span><span class="err">p:</span><span class="w"> </span><span class="err">price</span><span class="w">
        </span><span class="err">q:</span><span class="w"> </span><span class="err">quantity</span><span class="w">
        </span><span class="err">l:</span><span class="w"> </span><span class="err">maker</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">taker</span><span class="w">
        </span><span class="err">f:</span><span class="w"> </span><span class="err">fee</span><span class="w">
        </span><span class="err">fb:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="err">fee</span><span class="w"> </span><span class="err">discount</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='ledgers'>Ledgers</h2>
<p><strong>当有新的账单时，会收到 ledger 事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"ledger"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">i:</span><span class="w"> </span><span class="err">ledger</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">s:</span><span class="w"> </span><span class="err">币种符号</span><span class="w">
        </span><span class="err">p:</span><span class="w"> </span><span class="err">交易对</span><span class="w">
        </span><span class="err">T:</span><span class="w"> </span><span class="err">账单类型</span><span class="w"> </span><span class="mi">1</span><span class="err">划转</span><span class="p">,</span><span class="mi">2</span><span class="err">交易</span><span class="p">,</span><span class="mi">3</span><span class="err">交易手续费</span><span class="p">,</span><span class="mi">4</span><span class="err">资金费用</span><span class="p">,</span><span class="mi">5</span><span class="err">资金费用调整</span><span class="p">,</span><span class="mi">6</span><span class="err">降低风险等级减仓</span><span class="p">,</span><span class="mi">7</span><span class="err">强平</span><span class="p">,</span><span class="mi">8</span><span class="err">ADL系统减仓</span><span class="w">
        </span><span class="err">a:</span><span class="w"> </span><span class="err">改变量</span><span class="w">
        </span><span class="err">b:</span><span class="w"> </span><span class="err">余额</span><span class="w">
        </span><span class="err">t:</span><span class="w"> </span><span class="err">时间</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='deallogs'>DealLogs</h2>
<p><strong>当持仓量有变化时，会收到 dealLog 事件</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"stream"</span><span class="p">:</span><span class="s2">"dealLog"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">i:</span><span class="w"> </span><span class="err">'</span><span class="mi">1125899906843599056</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">deal</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">id</span><span class="w">
        </span><span class="err">m:</span><span class="w"> </span><span class="err">'</span><span class="mi">4</span><span class="err">STEPN_USDT'</span><span class="p">,</span><span class="w"> </span><span class="err">pair</span><span class="w">
        </span><span class="err">y:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">deal</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">type.</span><span class="w"> </span><span class="mi">1</span><span class="err">开仓，</span><span class="mi">2</span><span class="err">平仓，</span><span class="mi">3</span><span class="err">减仓降低风险等级</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="err">爆仓清空仓位</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="err">ADL</span><span class="w">
        </span><span class="err">p:</span><span class="w"> </span><span class="err">'</span><span class="mi">1125899906842624053</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">仓位id</span><span class="w">
        </span><span class="err">sd:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">仓位方向，</span><span class="mi">1</span><span class="err">多仓，</span><span class="mi">2</span><span class="err">空仓</span><span class="w">
        </span><span class="err">md:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">仓位模式，</span><span class="mi">1</span><span class="err">全仓，</span><span class="mi">2</span><span class="err">逐仓，</span><span class="mi">3</span><span class="err">全仓分仓，</span><span class="mi">4</span><span class="err">逐仓分仓</span><span class="w">
        </span><span class="err">hc:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="err">持仓数量</span><span class="w">
        </span><span class="err">hd:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="err">持仓改变量</span><span class="w">
        </span><span class="err">o:</span><span class="w"> </span><span class="mf">1.3592983336</span><span class="p">,</span><span class="w"> </span><span class="err">开仓均价</span><span class="w">
        </span><span class="err">pl:</span><span class="w"> </span><span class="mf">1.3336</span><span class="p">,</span><span class="w"> </span><span class="err">用到的价格</span><span class="w">
        </span><span class="err">fi:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">盈利</span><span class="w">
        </span><span class="err">f:</span><span class="w"> </span><span class="mf">0.0106688</span><span class="p">,</span><span class="w"> </span><span class="err">手续费</span><span class="w">
        </span><span class="err">fb:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="err">fb</span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">优惠券抵扣手续费</span><span class="w">
        </span><span class="err">t:</span><span class="w"> </span><span class="mi">1653541169000</span><span class="w"> </span><span class="err">时间</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h1 id='errors'>Errors</h1><h2 id='e08c1d4f9a'>错误码</h2>
<table><thead>
<tr>
<th>Code</th>
<th>描述</th>
<th>Msg</th>
</tr>
</thead><tbody>
<tr>
<td>2003</td>
<td>Cookie 失效</td>
<td>Cookie expired</td>
</tr>
<tr>
<td>2033</td>
<td>操作失败！订单已完成或已撤销</td>
<td>Operation failed! Order completed or canceled</td>
</tr>
<tr>
<td>2034</td>
<td>操作失败！请检查参数是否正确</td>
<td>Operation failed! Please check parameter</td>
</tr>
<tr>
<td>2040</td>
<td>操作失败！没有该订单</td>
<td>Operation failed! No record</td>
</tr>
<tr>
<td>2064</td>
<td>订单撤销中，不能再次撤销</td>
<td>Canceling. Unable to cancel again</td>
</tr>
<tr>
<td>2065</td>
<td>委托价格设置过高，请重新设置价格</td>
<td>Precatory price is exorbitant, please reset</td>
</tr>
<tr>
<td>2066</td>
<td>委托价格设置过低，请重新设置价格</td>
<td>Precatory price is low , please reset</td>
</tr>
<tr>
<td>2067</td>
<td>暂不支持市价单</td>
<td>Limit Order Only</td>
</tr>
<tr>
<td>2068</td>
<td>下单数量不能低于0.0001</td>
<td>Min Amount:0.0001</td>
</tr>
<tr>
<td>2069</td>
<td>市价单无法撤销</td>
<td>Market order can not be canceled</td>
</tr>
<tr>
<td>2078</td>
<td>下单价格非法</td>
<td>unvalid order price</td>
</tr>
<tr>
<td>2085</td>
<td>币种最小下单数量限制</td>
<td>the trade amount is low</td>
</tr>
<tr>
<td>2086</td>
<td>账户资产异常,限制下单</td>
<td>Abnormal account assets, trade is forbiden</td>
</tr>
<tr>
<td>2091</td>
<td>请求过于频繁，请稍后再试</td>
<td>request is too frequency, please try again later</td>
</tr>
<tr>
<td>2092</td>
<td>币种最小下单金额限制</td>
<td>Minimum amount not met</td>
</tr>
<tr>
<td>3000</td>
<td>请求参数错误</td>
<td>Requested parameter incorrect</td>
</tr>
<tr>
<td>3002</td>
<td>参数不能为空</td>
<td>Parameter cannot be null</td>
</tr>
<tr>
<td>3009</td>
<td>推送订阅channel不合法</td>
<td>Illegal subscription channel</td>
</tr>
<tr>
<td>3010</td>
<td>websocket连接异常</td>
<td>websocket connection error</td>
</tr>
<tr>
<td>3011</td>
<td>接口不支持apikey请求方式</td>
<td>Illegal subscribe event</td>
</tr>
<tr>
<td>3012</td>
<td>apikey无效</td>
<td>Interface does not support apikey request method</td>
</tr>
<tr>
<td>3016</td>
<td>交易对错误</td>
<td>Invalid apikey</td>
</tr>
<tr>
<td>3017</td>
<td>推送订阅event不合法</td>
<td>Trading pair error</td>
</tr>
<tr>
<td>3024</td>
<td>apikey权限不足</td>
<td>apikey authorization insufficient</td>
</tr>
<tr>
<td>3025</td>
<td>apikey签名验证失败</td>
<td>apikey signature verification failed</td>
</tr>
<tr>
<td>3026</td>
<td>apikey ip受限制</td>
<td>apikey ip is restricted</td>
</tr>
<tr>
<td>3027</td>
<td>账户没有apikey</td>
<td>No apikey in your account</td>
</tr>
<tr>
<td>3028</td>
<td>账户apikey数量超过了限制数量</td>
<td>Account apikey has exceeded the limit amount</td>
</tr>
<tr>
<td>3029</td>
<td>apikey允许ip数量超过了限制数量</td>
<td>apikey ip has exceeded the limit amount</td>
</tr>
<tr>
<td>3033</td>
<td>查询类请求限制一个cmd</td>
<td>query allow only one cmd</td>
</tr>
<tr>
<td>3034</td>
<td>最大cmd个数限制</td>
<td>maxinum cmds</td>
</tr>
<tr>
<td>3035</td>
<td>cmd请求个数限制</td>
<td>too many cmds</td>
</tr>
<tr>
<td>4000</td>
<td>当前网络连接不稳定，请稍候重试</td>
<td>the network is unstable now, please try again later</td>
</tr>
<tr>
<td>4003</td>
<td>服务器繁忙，请稍后再试</td>
<td>The server is busy, please try again later</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="csharp">csharp</a>
          </div>
      </div>
    </div>
  </body>
      <script>
        const lang_btn = document.getElementById('lang_box');
        const btn_spot_v4 = document.getElementById('btn_spot_v4');
        const btn_spot = document.getElementById('btn_spot');
        const btn_contract = document.getElementById('btn_contract-select');
        const btn_contract_v3 = document.getElementById('btn_contract_v3')
        const btn_contract_v4 = document.getElementById('btn_contract_v4')
        const btn_contract_coin = document.getElementById('btn_contract_coin')

        const btnSpotSelect = document.getElementById('btn_spot-select')
        const spot_select = document.getElementById('spot_select')

        const biboxLogo = document.getElementById('bibox-logo')

        const url = GetUrlRelativePath();

        if(url.indexOf('en') != -1){
          //英文
          btnSpotSelect.innerHTML = 'Spot'
          lang_btn.innerHTML = '中文';
          btn_spot.innerHTML = 'Spot v3';
          btn_spot_v4.innerHTML = 'Spot v4'
          btn_contract_coin.innerHTML = 'Contract Coin';
          btn_contract.innerHTML = 'Contract USDT';
          btn_contract_v3.innerHTML = 'Contract USDT v3';
          btn_contract_v4.innerHTML = 'Contract USDT v4';

          lang_btn.href = url.replace('en/', 'zh/');
          btn_spot.href = btn_spot.href.replace('zh/', 'en/');
          btn_spot_v4.href = btn_spot_v4.href.replace('zh/', 'en/')
          btn_contract_coin.href = btn_contract_coin.href.replace('zh/', 'en/');
          btn_contract_v3.href = btn_contract_v3.href.replace('zh/', 'en/');
          btn_contract_v4.href = btn_contract_v4.href.replace('zh/', 'en/');

          biboxLogo.onclick = function () {
            window.location.href = 'https://www.bibox.tech/en'
          }
        }else{
          //中文
          btnSpotSelect.innerHTML = '现货'
          lang_btn.innerHTML = 'English';
          btn_spot.innerHTML = '现货 v3';
          btn_spot_v4.innerHTML = '现货 v4'
          btn_contract_coin.innerHTML = '币本位永续合约';
          btn_contract.innerHTML = 'U本位永续合约';
          btn_contract_v3.innerHTML = 'U本位永续合约 v3';
          btn_contract_v4.innerHTML = 'U本位永续合约 v4';

          lang_btn.href = url.replace('zh/', 'en/');
          btn_spot.href = btn_spot.href.replace('en/', 'zh/');
          btn_spot_v4.href = btn_spot_v4.href.replace('en/', 'zh/');
          btn_contract_coin.href = btn_contract_coin.href.replace('en/', 'zh/');
          btn_contract_v3.href = btn_contract_v3.href.replace('en/', 'zh/');
          btn_contract_v4.href = btn_contract_v4.href.replace('en/', 'zh/');
          biboxLogo.onclick = function () {
            window.location.href = 'https://www.bibox.tech/zh'
          }
        }

        if(location.href.indexOf('/spot/v4/') > 0){
          btn_spot_v4.className = 'current';
          btn_contract_coin.className = '';
          btn_contract.className = '';
          btn_spot.className = '';
          spot_select.className = spot_select.className + ' current';
          btnSpotSelect.innerHTML = btnSpotSelect.innerHTML + ' v4'
          btnSpotSelect.innerHTML = btnSpotSelect.innerHTML.replace('v4 v4', 'v4');
        } else if(location.href.indexOf('/spot/v3/') > 0){
          btn_spot.className = 'current';
          btn_contract_coin.className = '';
          btn_contract.className = '';
          btn_spot_v4.className = '';
          spot_select.className = spot_select.className + ' current';
          btnSpotSelect.innerHTML = btnSpotSelect.innerHTML + ' v3'
          btnSpotSelect.innerHTML = btnSpotSelect.innerHTML.replace('v3 v3', 'v3');
        }
        else if(location.href.indexOf('/futures-coin/') > 0){
          btn_spot.className = '';
          btn_contract_coin.className = 'current';
          btn_contract.className = '';
          btn_spot_v4.className = '';
        }
        else if(location.href.indexOf('/futures/v4') > 0){
          btn_spot.className = '';
          btn_contract_coin.className = '';
          btn_contract.className = '';
          btn_contract.innerHTML = btn_contract.innerHTML + ' v4';
          btn_contract_v3.className = '';
          btn_contract_v4.className = 'current';
          btn_spot_v4.className = '';
        }
        else if(location.href.indexOf('/futures/') > 0){
          btn_spot.className = '';
          btn_contract_coin.className = '';
          btn_contract.innerHTML = btn_contract.innerHTML + ' v3';
          btn_contract.className = '';
          btn_contract_v4.className = '';
          btn_contract_v3.className = 'current';
          btn_spot_v4.className = '';
        }

        lang_btn.style.display = 'block';
        function GetUrlRelativePath(){
          let url = document.location.toString();
          let arrUrl = url.split("//");
          let start = arrUrl[1].indexOf("/");
          let relUrl = arrUrl[1].substring(start);
          if(relUrl.indexOf("?") != -1){
            relUrl = relUrl.split("?")[0];
          }
          if(relUrl.indexOf("#") != -1){
            relUrl = relUrl.split("#")[0];
          }
          return relUrl;
    　　}
      </script>
</html>
